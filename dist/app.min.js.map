{
  "version": 3,
  "sources": ["../public/js/API.js", "../public/js/state.js", "../public/js/utils.js", "../public/js/player.js", "../public/js/ui.js", "../public/js/app/library.js", "../public/js/app/albums.js", "../public/js/app/search.js", "../public/js/app/artists.js", "../public/js/app/stats.js", "../public/js/app/playlistImportExport.js", "../public/js/app/settings.js", "../public/js/app/viewSwitcher.js", "../public/js/app/views.js", "../public/js/app/playlists.js", "../public/js/app/uiModals.js", "../public/js/app/scan.js", "../public/js/app/navigation.js", "../public/js/app/playerSetup.js", "../public/js/app/sidebar.js", "../public/js/app/dropdowns.js", "../public/js/app/shell.js", "../public/app.js"],
  "sourcesContent": [
    "// ============================================\n// API Configuration - Change URL here only\n// ============================================\n// Default: same-origin backend (works in local dev, Codespaces, and production)\n// Optional override: set `window.__PLAYER0_API_URL = 'https://example.com/api'` before this module loads.\nconst API_URL = window.__PLAYER0_API_URL || `${window.location.origin}/api`;\n\n// Export API_URL for use in other modules\nexport { API_URL };\n\n// ============================================\n// Cache Configuration\n// ============================================\nconst CACHE_DURATION = 7 * 24 * 60 * 60 * 1000; // 1 week\nconst cache = new Map();\n\n// Dev mode disables caching entirely.\n// Enable via any of:\n// - `window.__PLAYER0_DEV_MODE = true` (set before this module loads)\n// - URL query `?dev=1` (or `?dev=true`)\n// - localStorage key `player0.devMode` set to `\"1\"` or `\"true\"`\n// - hostname `localhost` / `127.0.0.1`\nfunction isDevMode() {\n    try {\n        if (window.__PLAYER0_DEV_MODE === true) return true;\n\n        const params = new URLSearchParams(window.location.search);\n        const devParam = params.get('dev');\n        if (devParam === '' || devParam === '1' || devParam === 'true') return true;\n\n        const ls = localStorage.getItem('player0.devMode');\n        if (ls === '1' || ls === 'true') return true;\n\n        const host = window.location.hostname;\n        if (host === 'localhost' || host === '127.0.0.1') return true;\n    } catch {\n        // ignore\n    }\n\n    return false;\n}\n\nfunction getCacheKey(endpoint) {\n  return endpoint;\n}\n\nfunction getFromCache(key) {\n  const cached = cache.get(key);\n  if (cached && Date.now() - cached.timestamp < CACHE_DURATION) {\n    return cached.data;\n  }\n  cache.delete(key);\n  return null;\n}\n\nfunction setCache(key, data) {\n  cache.set(key, {\n    data,\n    timestamp: Date.now()\n  });\n}\n\nfunction clearCache() {\n  cache.clear();\n}\n\nasync function fetchWithCache(url, options = {}) {\n  const cacheKey = getCacheKey(url);\n\n    // Dev mode: bypass in-memory cache and tell fetch to avoid HTTP cache.\n    if (isDevMode()) {\n        const headers = new Headers(options.headers || {});\n        headers.set('Cache-Control', 'no-cache');\n\n        const response = await fetch(url, {\n            ...options,\n            headers,\n            cache: 'no-store'\n        });\n        const data = await response.json();\n\n        if (!response.ok) {\n            throw new Error(data.message || 'API request failed');\n        }\n\n        return data;\n    }\n  \n  // Check cache for GET requests only\n  if (!options.method || options.method === 'GET') {\n    const cached = getFromCache(cacheKey);\n    if (cached) {\n      return cached;\n    }\n  }\n  \n  const response = await fetch(url, options);\n  const data = await response.json();\n  \n  if (!response.ok) {\n    throw new Error(data.message || 'API request failed');\n  }\n  \n  // Cache successful GET responses\n  if (!options.method || options.method === 'GET') {\n    setCache(cacheKey, data);\n  }\n  \n  return data;\n}\n\n// ============================================\n// Search APIs\n// ============================================\n\n/**\n * Get search suggestions/autocomplete\n * @param {string} query - Partial search query (min 2 chars)\n * @param {number} limit - Max suggestions per category\n * @returns {Object} { artists, albums, songs, genres }\n */\nasync function getSearchSuggestions(query, limit = 5) {\n    if (!query || query.length < 2) {\n        return { artists: [], albums: [], songs: [], genres: [] };\n    }\n    \n    const response = await fetch(`${API_URL}/suggestions?q=${encodeURIComponent(query)}&limit=${limit}`);\n    const data = await response.json();\n    \n    if (!response.ok) {\n        throw new Error(data.message || 'Error getting suggestions');\n    }\n    \n    return data;\n}\n\nasync function simpleSearch(input) {\n    const response = await fetch(`${API_URL}/search?q=${encodeURIComponent(input)}`);\n    const data = await response.json();\n\n    if(!response.ok) {\n        throw new Error(data.message || 'Error performing search');\n    }\n\n    return data;\n}\n\nasync function advancedSearch({ title, artist, album, genre, year, minDuration, maxDuration } = {}) {\n    const queryParams = new URLSearchParams();\n\n    if (title) queryParams.append('title', title);\n    if (artist) queryParams.append('artist', artist);\n    if (album) queryParams.append('album', album);\n    if (genre) queryParams.append('genre', genre);\n    if (year) queryParams.append('year', year);\n    if (minDuration) queryParams.append('minDuration', minDuration);\n    if (maxDuration) queryParams.append('maxDuration', maxDuration);\n\n    const response = await fetch(`${API_URL}/search?${queryParams}`);\n    const data = await response.json();\n\n    if(!response.ok) {\n        throw new Error(data.message || 'Error performing advanced search');\n    }\n\n    return data;\n}\n\n// ============================================\n// Songs APIs\n// ============================================\n\nasync function fetchAllSongs() {\n    return await fetchWithCache(`${API_URL}/songs`);\n}\n\nfunction songCoverUrl(songId) {\n    return `${API_URL}/cover/${songId}`;\n}\n\nfunction songStreamUrl(songId) {\n    return `${API_URL}/stream/${songId}`;\n}\n\nasync function recordPlay(songId) {\n    const response = await fetch(`${API_URL}/play/${songId}`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ durationPlayed: 0 })\n    });\n    \n    if(!response.ok) {\n        const data = await response.json();\n        throw new Error(data.message || 'Error recording play');\n    }\n    \n    return response.json();\n}\n\n// ============================================\n// Albums APIs\n// ============================================\n\nasync function listAlbums() {\n    return await fetchWithCache(`${API_URL}/albums`);\n}\n\nasync function getAlbumDetail(artist, album) {\n    return await fetchWithCache(`${API_URL}/albums/${encodeURIComponent(artist)}/${encodeURIComponent(album)}`);\n}\n\nfunction albumCoverUrl(songId) {\n    return `${API_URL}/cover/${songId}`;\n}\n\n// ============================================\n// Artists APIs\n// ============================================\n\nasync function listArtists() {\n    return await fetchWithCache(`${API_URL}/artists`);\n}\n\n// ============================================\n// Playlists APIs\n// ============================================\n\nasync function listPlaylists() {\n    const data = await fetchWithCache(`${API_URL}/playlists`);\n    return data;\n}\n\nasync function getPlaylist(id) {\n    const data = await fetchWithCache(`${API_URL}/playlists/${id}`);\n    return data;\n}\n\nasync function createPlaylist(name, description = '', songIds = []) {\n    const response = await fetch(`${API_URL}/playlists`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ name, description, songIds })\n    });\n    \n    if (!response.ok) {\n        const data = await response.json();\n        throw new Error(data.error || 'Failed to create playlist');\n    }\n    \n    // Clear cache\n    cache.delete(getCacheKey(`${API_URL}/playlists`));\n    \n    return await response.json();\n}\n\nasync function updatePlaylist(id, updates) {\n    const response = await fetch(`${API_URL}/playlists/${id}`, {\n        method: 'PUT',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(updates)\n    });\n    \n    if (!response.ok) {\n        const data = await response.json();\n        throw new Error(data.error || 'Failed to update playlist');\n    }\n    \n    // Clear cache\n    cache.delete(getCacheKey(`${API_URL}/playlists/${id}`));\n    cache.delete(getCacheKey(`${API_URL}/playlists`));\n    \n    return await response.json();\n}\n\nasync function deletePlaylist(id) {\n    const response = await fetch(`${API_URL}/playlists/${id}`, {\n        method: 'DELETE'\n    });\n    \n    if (!response.ok) {\n        const data = await response.json();\n        throw new Error(data.error || 'Failed to delete playlist');\n    }\n    \n    // Clear cache\n    cache.delete(getCacheKey(`${API_URL}/playlists/${id}`));\n    cache.delete(getCacheKey(`${API_URL}/playlists`));\n    \n    return await response.json();\n}\n\nasync function addSongToPlaylist(playlistId, songId) {\n    const playlist = await getPlaylist(playlistId);\n    const songIds = playlist.songIds || [];\n    \n    if (songIds.includes(songId)) {\n        return playlist; // Already in playlist\n    }\n    \n    return await updatePlaylist(playlistId, { songIds: [...songIds, songId] });\n}\n\nasync function removeSongFromPlaylist(playlistId, songId) {\n    const playlist = await getPlaylist(playlistId);\n    const songIds = (playlist.songIds || []).filter(id => id !== songId);\n    return await updatePlaylist(playlistId, { songIds });\n}\n\n// ============================================\n// Statistics APIs\n// ============================================\n\nasync function getStats() {\n    // Stats change frequently (plays, recently played, listening time). Avoid long-lived caching.\n    const response = await fetch(`${API_URL}/stats`, { cache: 'no-store' });\n    const data = await response.json();\n\n    if (!response.ok) {\n        throw new Error(data.message || 'API request failed');\n    }\n\n    return data;\n}\n\n// ============================================\n// Library Management APIs\n// ============================================\n\nasync function scanLibrary() {\n    const response = await fetch(`${API_URL}/scan`, { method: 'POST' });\n    const data = await response.json();\n\n    if (!response.ok) {\n        throw new Error(data.error || data.message || 'Error scanning library');\n    }\n\n    // Scanning changes library data: clear cache.\n    clearCache();\n    return data;\n}\n\n// ============================================\n// Exports\n// ============================================\n\nexport { \n    getSearchSuggestions,\n    simpleSearch, \n    advancedSearch, \n    fetchAllSongs, \n    songCoverUrl,\n    songStreamUrl,\n    recordPlay,\n    listAlbums,\n    getAlbumDetail,\n    albumCoverUrl,\n    listArtists,\n    listPlaylists,\n    getPlaylist,\n    createPlaylist,\n    updatePlaylist,\n    deletePlaylist,\n    addSongToPlaylist,\n    removeSongFromPlaylist,\n    getStats,\n    scanLibrary,\n    clearCache\n};",
    "/**\n * ============================================\n * Application State Management\n * ============================================\n * \n * Centralized state management for the music player.\n * Manages songs and playback state.\n * \n * State Variables:\n * - allSongs: Complete library of songs\n * - currentSongs: Currently displayed/filtered songs\n * - playbackList: Currently active playback list\n * - playbackIndex: Current position in playback list\n * - isPlaying: Playback status\n * \n * @module state\n */\n\n/**\n * Complete song library\n * @type {Array<Object>}\n */\nexport let allSongs = [];\n\n/**\n * Currently displayed songs (filtered/searched)\n * @type {Array<Object>}\n */\nexport let currentSongs = [];\n\n/**\n * Currently active playback list\n * @type {Array<Object>}\n */\nexport let playbackList = [];\n\n/**\n * Current song index in playback list\n * @type {number}\n */\nexport let playbackIndex = -1;\n\n/**\n * Playback state\n * @type {boolean}\n */\nexport let isPlaying = false;\n\n/**\n * Shuffle mode\n * @type {boolean}\n */\nexport let isShuffleEnabled = false;\n\n/**\n * Repeat mode\n * - off: stop at end\n * - one: repeat current song\n * - all: loop entire list\n * @type {'off'|'one'|'all'}\n */\nexport let repeatMode = 'off';\n\n/**\n * Normalize an index to an integer.\n * @param {any} value\n * @returns {number}\n */\nfunction toInt(value) {\n  const num = Number(value);\n  return Number.isFinite(num) ? Math.trunc(num) : 0;\n}\n\n/**\n * Clamp a number to a range.\n * @param {number} value\n * @param {number} min\n * @param {number} max\n * @returns {number}\n */\nfunction clamp(value, min, max) {\n  return Math.min(max, Math.max(min, value));\n}\n\n/**\n * Set all songs\n * @param {Array<any>} songs\n */\nexport function setAllSongs(songs) {\n  allSongs = songs;\n}\n\n/**\n * Set current songs\n * @param {Array<any>} songs\n */\nexport function setCurrentSongs(songs) {\n  currentSongs = songs;\n}\n\n/**\n * Set active playback list\n * @param {Array<any>} list\n * @param {number} index\n */\nexport function setPlaybackList(list, index = 0) {\n  playbackList = Array.isArray(list) ? list : [];\n  if (playbackList.length === 0) {\n    playbackIndex = -1;\n    return;\n  }\n\n  playbackIndex = clamp(toInt(index), 0, playbackList.length - 1);\n}\n\n/**\n * Clear the playback list.\n * By default keeps the currently playing song as the only item.\n * @param {{ keepCurrent?: boolean }} [options]\n */\nexport function clearPlaybackList(options = {}) {\n  const keepCurrent = options.keepCurrent !== false;\n\n  if (!keepCurrent || playbackIndex < 0 || playbackIndex >= playbackList.length) {\n    playbackList = [];\n    playbackIndex = -1;\n    return;\n  }\n\n  const currentSong = playbackList[playbackIndex];\n  playbackList = [currentSong];\n  playbackIndex = 0;\n}\n\n/**\n * Set playing state\n * @param {boolean} playing\n */\nexport function setIsPlaying(playing) {\n  isPlaying = playing;\n}\n\n/**\n * Enable/disable shuffle.\n * @param {boolean} enabled\n */\nexport function setShuffleEnabled(enabled) {\n  isShuffleEnabled = Boolean(enabled);\n}\n\n/**\n * Toggle shuffle. When enabling, shuffles upcoming songs in-place.\n * @returns {boolean} New shuffle state\n */\nexport function toggleShuffle() {\n  isShuffleEnabled = !isShuffleEnabled;\n  if (isShuffleEnabled) {\n    shuffleUpcoming();\n  }\n  return isShuffleEnabled;\n}\n\n/**\n * Set repeat mode.\n * @param {'off'|'one'|'all'} mode\n */\nexport function setRepeatMode(mode) {\n  if (mode === 'off' || mode === 'one' || mode === 'all') {\n    repeatMode = mode;\n  }\n}\n\n/**\n * Cycle repeat mode: off -> all -> one -> off\n * @returns {'off'|'one'|'all'} New repeat mode\n */\nexport function cycleRepeatMode() {\n  repeatMode = repeatMode === 'off' ? 'all' : repeatMode === 'all' ? 'one' : 'off';\n  return repeatMode;\n}\n\nfunction shuffleArrayInPlace(array) {\n  for (let i = array.length - 1; i > 0; i--) {\n    const j = Math.floor(Math.random() * (i + 1));\n    [array[i], array[j]] = [array[j], array[i]];\n  }\n  return array;\n}\n\n/**\n * Shuffle the list items after the current index.\n * Keeps the currently playing song fixed.\n */\nexport function shuffleUpcoming() {\n  if (!playbackList.length) return;\n  const start = Math.max(0, playbackIndex + 1);\n  if (start >= playbackList.length - 1) return;\n  const upcoming = playbackList.slice(start);\n  shuffleArrayInPlace(upcoming);\n  playbackList.splice(start, playbackList.length - start, ...upcoming);\n}\n\n/**\n * Whether there is a next song in the active list\n * @returns {boolean} - Whether there is a next song\n */\nexport function hasNext() {\n  return playbackIndex >= 0 && playbackIndex < playbackList.length - 1;\n}\n\n/**\n * Whether there is a previous song in the active list\n * @returns {boolean} - Whether there is a previous song\n */\nexport function hasPrevious() {\n  return playbackIndex > 0;\n}\n\n/**\n * Move to next song\n * @returns {any} - The next song or null\n */\nexport function getNext() {\n  if (hasNext()) {\n    playbackIndex++;\n    return playbackList[playbackIndex];\n  }\n  return null;\n}\n\n/**\n * Move to previous song\n * @returns {any} - The previous song or null\n */\nexport function getPrevious() {\n  if (hasPrevious()) {\n    playbackIndex--;\n    return playbackList[playbackIndex];\n  }\n  return null;\n}\n\n/**\n * Get current song\n * @returns {any} - The current song or null\n */\nexport function getCurrentSong() {\n  return playbackList[playbackIndex] || null;\n}\n\n/**\n * Set current playing index within the active playback list.\n * @param {number} index\n */\nexport function setPlaybackIndex(index) {\n  if (!playbackList.length) {\n    playbackIndex = -1;\n    return;\n  }\n  playbackIndex = clamp(toInt(index), 0, playbackList.length - 1);\n}\n\n/**\n * Move an item within the active playback list.\n * Keeps the currently playing track pointing at the same item.\n * @param {number} fromIndex\n * @param {number} toIndex\n */\nexport function movePlaybackItem(fromIndex, toIndex) {\n  const from = toInt(fromIndex);\n  if (from < 0 || from >= playbackList.length) return;\n\n  const to = clamp(toInt(toIndex), 0, playbackList.length - 1);\n  if (from === to) return;\n\n  const [moved] = playbackList.splice(from, 1);\n  playbackList.splice(to, 0, moved);\n\n  // Keep playbackIndex referencing the same song.\n  if (from === playbackIndex) {\n    playbackIndex = to;\n    return;\n  }\n\n  // Adjust playbackIndex when the moved element crosses it.\n  if (from < playbackIndex && to >= playbackIndex) {\n    playbackIndex -= 1;\n  } else if (from > playbackIndex && to <= playbackIndex) {\n    playbackIndex += 1;\n  }\n}\n\n/**\n * Remove an item from the active playback list.\n * Adjusts playbackIndex so it continues to reference the current song when possible.\n * @param {number} index\n * @returns {{ removed: any, removedWasCurrent: boolean, newIndex: number } | null}\n */\nexport function removePlaybackItem(index) {\n  const i = toInt(index);\n  if (i < 0 || i >= playbackList.length) return null;\n\n  const removedWasCurrent = i === playbackIndex;\n  const [removed] = playbackList.splice(i, 1);\n\n  if (playbackList.length === 0) {\n    playbackIndex = -1;\n    return { removed, removedWasCurrent, newIndex: -1 };\n  }\n\n  if (i < playbackIndex) {\n    playbackIndex -= 1;\n  } else if (removedWasCurrent) {\n    playbackIndex = clamp(i, 0, playbackList.length - 1);\n  }\n\n  return { removed, removedWasCurrent, newIndex: playbackIndex };\n}\n\n/**\n * Append one or more songs to the end of the active playback list (queue).\n * Does not start playback.\n * @param {any|any[]} songs\n */\nexport function enqueueSongs(songs) {\n  const items = Array.isArray(songs) ? songs : [songs];\n  const toAdd = items.filter(Boolean);\n  if (toAdd.length === 0) return;\n\n  if (!playbackList.length) {\n    playbackList = [...toAdd];\n    playbackIndex = 0;\n    return;\n  }\n\n  playbackList.push(...toAdd);\n}\n\n/**\n * Insert one or more songs as the next items after the current song.\n * If nothing is queued yet, seeds the playback list.\n * Does not start playback.\n * @param {any|any[]} songs\n */\nexport function playNextSongs(songs) {\n  const items = Array.isArray(songs) ? songs : [songs];\n  const toAdd = items.filter(Boolean);\n  if (toAdd.length === 0) return;\n\n  if (!playbackList.length) {\n    playbackList = [...toAdd];\n    playbackIndex = 0;\n    return;\n  }\n\n  const insertAt = playbackIndex >= 0 ? playbackIndex + 1 : playbackList.length;\n  playbackList.splice(insertAt, 0, ...toAdd);\n}\n",
    "/**\n * ============================================\n * Utility Functions Module\n * ============================================\n * \n * Common helper functions used throughout the application:\n * - Time formatting\n * - HTML escaping for XSS prevention\n * - Debounce for search optimization\n * - Lazy loading for images\n * \n * @module utils\n */\n\n/**\n * Format seconds into MM:SS display format\n * @param {number} seconds - Time in seconds\n * @returns {string} Formatted time string (e.g., \"3:45\")\n */\nfunction formatDuration(seconds) {\n  if (!seconds || isNaN(seconds)) return '0:00';\n  const mins = Math.floor(seconds / 60);\n  const secs = Math.floor(seconds % 60);\n  return `${mins}:${secs.toString().padStart(2, '0')}`;\n}\n\n/**\n * Escape HTML to prevent XSS attacks\n * Converts special characters to HTML entities\n * @param {string} text - Text to escape\n * @returns {string} HTML-safe text\n */\nfunction escapeHtml(text) {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\n/**\n * Debounce function to limit execution rate\n * Useful for search input to avoid excessive API calls\n * @param {Function} func - Function to debounce\n * @param {number} wait - Milliseconds to wait\n * @returns {Function} Debounced function\n */\nfunction debounce(func, wait) {\n  let timeout;\n  return function executedFunction(...args) {\n    const later = () => {\n      clearTimeout(timeout);\n      func(...args);\n    };\n    clearTimeout(timeout);\n    timeout = setTimeout(later, wait);\n  };\n}\n\n/**\n * Lazy loading observer for images\n * Uses IntersectionObserver for efficient viewport-based loading\n */\nlet lazyLoadObserver = null;\n\n/**\n * Initialize lazy loading for images\n * Call once on app startup\n */\nfunction initLazyLoading() {\n  if (lazyLoadObserver) return;\n  \n  if (!('IntersectionObserver' in window)) {\n    // Fallback for browsers without IntersectionObserver\n    console.log('IntersectionObserver not supported, loading all images immediately');\n    return;\n  }\n  \n  lazyLoadObserver = new IntersectionObserver((entries, observer) => {\n    entries.forEach(entry => {\n      if (entry.isIntersecting) {\n        const img = entry.target;\n        const src = img.dataset.src;\n        \n        if (src) {\n          img.src = src;\n          img.removeAttribute('data-src');\n          img.classList.remove('lazy');\n          img.classList.add('loaded');\n        }\n        \n        observer.unobserve(img);\n      }\n    });\n  }, {\n    rootMargin: '100px 0px', // Start loading 100px before entering viewport\n    threshold: 0.01\n  });\n}\n\n/**\n * Observe an image element for lazy loading\n * @param {HTMLImageElement} img - Image element to observe\n */\nfunction observeLazyImage(img) {\n  if (!lazyLoadObserver) {\n    // If observer not available, load immediately\n    const src = img.dataset.src;\n    if (src) {\n      img.src = src;\n      img.removeAttribute('data-src');\n    }\n    return;\n  }\n  \n  lazyLoadObserver.observe(img);\n}\n\n/**\n * Setup lazy loading for all images with data-src attribute in a container\n * @param {HTMLElement} container - Container element to search for lazy images\n */\nfunction setupLazyImages(container = document) {\n  const lazyImages = container.querySelectorAll('img[data-src]');\n  lazyImages.forEach(img => observeLazyImage(img));\n}\n\n/**\n * Create a lazy-loadable image element\n * @param {string} src - Image source URL\n * @param {string} alt - Alt text\n * @param {string} className - CSS class name\n * @returns {string} HTML string for lazy image\n */\nfunction lazyImageHtml(src, alt, className = '') {\n  const escapedSrc = escapeHtml(src);\n  const escapedAlt = escapeHtml(alt);\n  const classAttr = className ? `class=\"${escapeHtml(className)} lazy\"` : 'class=\"lazy\"';\n  \n  // Use a tiny transparent placeholder\n  const placeholder = 'data:image/svg+xml,%3Csvg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 1 1\"%3E%3C/svg%3E';\n  \n  return `<img ${classAttr} src=\"${placeholder}\" data-src=\"${escapedSrc}\" alt=\"${escapedAlt}\" loading=\"lazy\" />`;\n}\n\nexport { \n  formatDuration, \n  escapeHtml, \n  debounce, \n  initLazyLoading, \n  observeLazyImage, \n  setupLazyImages,\n  lazyImageHtml \n};",
    "// Player Module - Audio playback functionality\nimport { formatDuration } from './utils.js';\nimport { API_URL, songStreamUrl, albumCoverUrl, recordPlay as recordPlayAPI } from './API.js';\nimport { \n  playbackList,\n  playbackIndex,\n  setPlaybackList,\n  setPlaybackIndex,\n  movePlaybackItem,\n  removePlaybackItem,\n  setIsPlaying,\n  isShuffleEnabled,\n  repeatMode,\n  toggleShuffle,\n  cycleRepeatMode,\n  shuffleUpcoming,\n  getCurrentSong,\n  getNext,\n  getPrevious,\n  hasNext,\n  hasPrevious\n} from './state.js';\n\nlet audioPlayer = null;\n\nlet draggingPlaybackIndex = null;\nlet isQueueExpanded = false;\nconst QUEUE_COLLAPSED_COUNT = 8;\n\nlet touchQueueDrag = null;\nlet touchQueueDragListenersAttached = false;\n\nfunction isCoarsePointer() {\n  try {\n    return Boolean(window.matchMedia && window.matchMedia('(pointer: coarse)').matches);\n  } catch {\n    return false;\n  }\n}\n\nfunction clearQueueDragOverStates(queueList) {\n  queueList.querySelectorAll('.queue-item.is-drag-over, .queue-item.is-touch-dragging').forEach((el) => {\n    el.classList.remove('is-drag-over', 'is-touch-dragging');\n  });\n}\n\nfunction startTouchQueueDrag(event, fromIndex, fromItem, queueList) {\n  if (!event || event.button === 2) return;\n\n  touchQueueDrag = {\n    pointerId: event.pointerId,\n    fromIndex,\n    toIndex: null,\n    queueList\n  };\n\n  clearQueueDragOverStates(queueList);\n  fromItem.classList.add('is-touch-dragging');\n  queueList.classList.add('is-touch-dragging');\n\n  // Attach listeners to document so moves are captured even if the pointer is\n  // captured by the handle (common on mobile browsers).\n  if (!touchQueueDragListenersAttached) {\n    document.addEventListener('pointermove', handleTouchQueueDragMove, { passive: false });\n    document.addEventListener('pointerup', finishTouchQueueDrag);\n    document.addEventListener('pointercancel', finishTouchQueueDrag);\n    touchQueueDragListenersAttached = true;\n  }\n}\n\nfunction handleTouchQueueDragMove(event) {\n  if (!touchQueueDrag) return;\n  if (event.pointerId !== touchQueueDrag.pointerId) return;\n  event.preventDefault();\n\n  const queueList = touchQueueDrag.queueList;\n  const el = document.elementFromPoint(event.clientX, event.clientY);\n  const overItem = el?.closest?.('.queue-item');\n  if (!overItem || !queueList.contains(overItem)) return;\n\n  const toTarget = Number(overItem.dataset.playbackIndex);\n  if (!Number.isFinite(toTarget)) return;\n\n  const rect = overItem.getBoundingClientRect();\n  const placeAfter = (event.clientY - rect.top) > rect.height / 2;\n  const to = computeDropToIndex(touchQueueDrag.fromIndex, toTarget, placeAfter);\n\n  clearQueueDragOverStates(queueList);\n  overItem.classList.add('is-drag-over');\n  touchQueueDrag.toIndex = to;\n}\n\nfunction finishTouchQueueDrag(event) {\n  if (!touchQueueDrag) return;\n  if (event.pointerId !== touchQueueDrag.pointerId) return;\n\n  const { queueList, fromIndex, toIndex } = touchQueueDrag;\n  touchQueueDrag = null;\n\n  if (touchQueueDragListenersAttached) {\n    document.removeEventListener('pointermove', handleTouchQueueDragMove);\n    document.removeEventListener('pointerup', finishTouchQueueDrag);\n    document.removeEventListener('pointercancel', finishTouchQueueDrag);\n    touchQueueDragListenersAttached = false;\n  }\n\n  queueList.classList.remove('is-touch-dragging');\n  clearQueueDragOverStates(queueList);\n\n  if (toIndex == null || fromIndex === toIndex) return;\n  movePlaybackItem(fromIndex, toIndex);\n  updateQueue();\n}\n\nfunction setMiniPlayerPresence(hasSong) {\n  document.body.classList.toggle('has-mini-player', Boolean(hasSong));\n\n  const miniPlayer = document.getElementById('miniPlayer');\n  if (!miniPlayer) return;\n\n  if (!hasSong) {\n    miniPlayer.style.display = 'none';\n    miniPlayer.style.transform = 'translateY(100%)';\n    return;\n  }\n\n  const appContainer = document.querySelector('.app-container');\n  const sidebarClosed = Boolean(appContainer?.classList.contains('sidebar-closed'));\n  if (!sidebarClosed) return;\n\n  miniPlayer.style.display = 'flex';\n  requestAnimationFrame(() => {\n    miniPlayer.style.transform = 'translateY(0)';\n  });\n}\n\nfunction clearPendingHideSidebarTimeout() {\n  const id = window.__player0PendingHideSidebarTimeout;\n  if (id) {\n    clearTimeout(id);\n    window.__player0PendingHideSidebarTimeout = null;\n  }\n}\n\nfunction setPendingHideSidebarTimeout(id) {\n  window.__player0PendingHideSidebarTimeout = id;\n}\n\n/**\n * Initialize the player with audio element reference\n * @param {HTMLAudioElement} audioElement\n */\nexport function initPlayer(audioElement) {\n  audioPlayer = audioElement;\n  \n  // Setup event listeners\n  audioPlayer.addEventListener('timeupdate', updateProgress);\n  audioPlayer.addEventListener('ended', playNext);\n  audioPlayer.addEventListener('play', () => {\n    setIsPlaying(true);\n    updatePlayButton();\n  });\n  audioPlayer.addEventListener('pause', () => {\n    setIsPlaying(false);\n    updatePlayButton();\n  });\n  initShuffleRepeatControls();\n  updateShuffleRepeatButtons();\n\n  const toggleQueueExpanded = document.getElementById('toggleQueueExpanded');\n  toggleQueueExpanded?.addEventListener('click', () => {\n    isQueueExpanded = !isQueueExpanded;\n    updateQueue();\n  });\n\n  // Initial render (empty until something starts playing).\n  updateQueue();\n\n  setMiniPlayerPresence(Boolean(getCurrentSong()));\n}\n\nfunction initShuffleRepeatControls() {\n  const shuffleButton = document.getElementById('shuffleButton');\n  const repeatButton = document.getElementById('repeatButton');\n\n  if (shuffleButton) {\n    shuffleButton.addEventListener('click', (event) => {\n      event.preventDefault();\n      toggleShuffle();\n      // When shuffle is enabled, upcoming is shuffled in-place.\n      updateShuffleRepeatButtons();\n      updateQueue();\n    });\n  }\n\n  if (repeatButton) {\n    repeatButton.addEventListener('click', (event) => {\n      event.preventDefault();\n      cycleRepeatMode();\n      updateShuffleRepeatButtons();\n    });\n  }\n}\n\nfunction computeDropToIndex(fromIndex, targetIndex, placeAfter) {\n  let to = targetIndex + (placeAfter ? 1 : 0);\n  // Convert from \"original\" index space to post-removal index space.\n  if (fromIndex < to) to -= 1;\n  return to;\n}\n\nfunction updateShuffleRepeatButtons() {\n  const shuffleButton = document.getElementById('shuffleButton');\n  const repeatButton = document.getElementById('repeatButton');\n\n  if (shuffleButton) {\n    shuffleButton.classList.toggle('is-active', Boolean(isShuffleEnabled));\n    shuffleButton.title = isShuffleEnabled ? 'Shuffle: On' : 'Shuffle: Off';\n  }\n\n  if (repeatButton) {\n    const label = repeatMode === 'one' ? 'Repeat: One' : repeatMode === 'all' ? 'Repeat: All' : 'Repeat: Off';\n    repeatButton.title = label;\n    repeatButton.classList.toggle('is-active', repeatMode !== 'off');\n\n    if (repeatMode === 'one') {\n      repeatButton.innerHTML = '<svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" width=\"24\" height=\"24\"><path d=\"M17 1l4 4-4 4\"/><path d=\"M3 11V9a4 4 0 0 1 4-4h14\"/><path d=\"M7 23l-4-4 4-4\"/><path d=\"M21 13v2a4 4 0 0 1-4 4H3\"/><path d=\"M12 8v8\"/><path d=\"M10.5 10.5L12 9l1.5 1.5\"/><path d=\"M10.5 15.5L12 17l1.5-1.5\"/></svg>';\n    } else {\n      // Default repeat icon (off/all)\n      repeatButton.innerHTML = '<svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" width=\"24\" height=\"24\"><path d=\"M17 1l4 4-4 4\"/><path d=\"M3 11V9a4 4 0 0 1 4-4h14\"/><path d=\"M7 23l-4-4 4-4\"/><path d=\"M21 13v2a4 4 0 0 1-4 4H3\"/></svg>';\n    }\n  }\n}\n\n/**\n * Play a specific song\n * @param {any} song - The song to play\n */\nexport function playSong(song) {\n  if (!song || !audioPlayer) return;\n  \n  audioPlayer.src = songStreamUrl(song.id);\n  audioPlayer.play();\n  \n  // Update UI\n  document.getElementById('npTitle').textContent = song.title || 'Unknown';\n  document.getElementById('npArtist').textContent = song.artist || 'Unknown Artist';\n  document.getElementById('miniTitle').textContent = song.title || 'Unknown';\n  document.getElementById('miniArtist').textContent = song.artist || 'Unknown Artist';\n  \n  // Set album artwork\n  const npArtwork = document.getElementById('npArtwork');\n  npArtwork.onerror = () => {\n    npArtwork.style.display = 'none';\n  };\n  npArtwork.src = albumCoverUrl(song.id);\n  npArtwork.style.display = 'block';\n\n  setMiniPlayerPresence(true);\n\n  updateShuffleRepeatButtons();\n\n  updateQueue();\n  \n  // Record play\n  recordPlay(song.id);\n}\n\n/**\n * Toggle play/pause\n */\nexport function togglePlayPause() {\n  if (!audioPlayer) return;\n  \n  if (audioPlayer.paused) {\n    audioPlayer.play();\n  } else {\n    audioPlayer.pause();\n  }\n}\n\n/**\n * Play next song in the active playback list\n */\nexport function playNext() {\n  if (!playbackList.length) return;\n\n  if (repeatMode === 'one') {\n    // Restart current track without re-recording play.\n    if (audioPlayer) {\n      audioPlayer.currentTime = 0;\n      void audioPlayer.play();\n    }\n    return;\n  }\n\n  const nextSong = getNext();\n  if (nextSong) {\n    playSong(nextSong);\n    return;\n  }\n\n  if (repeatMode === 'all') {\n    if (isShuffleEnabled && playbackList.length > 1) {\n      const shuffled = [...playbackList].sort(() => Math.random() - 0.5);\n      setPlaybackList(shuffled, 0);\n      playSong(shuffled[0]);\n      return;\n    }\n\n    setPlaybackIndex(0);\n    playSong(playbackList[0]);\n  }\n}\n\n/**\n * Play previous song in the active playback list\n */\nexport function playPrevious() {\n  if (!playbackList.length) return;\n\n  // If we're not near the start, behave like typical players.\n  if (audioPlayer && audioPlayer.currentTime > 3) {\n    audioPlayer.currentTime = 0;\n    return;\n  }\n\n  const prevSong = getPrevious();\n  if (prevSong) {\n    playSong(prevSong);\n    return;\n  }\n\n  if (repeatMode === 'all') {\n    const lastIndex = Math.max(0, playbackList.length - 1);\n    setPlaybackIndex(lastIndex);\n    playSong(playbackList[lastIndex]);\n  }\n}\n\n/**\n * Update progress bar\n */\nfunction updateProgress() {\n  if (!audioPlayer) return;\n  \n  const progress = (audioPlayer.currentTime / audioPlayer.duration) * 100;\n  document.getElementById('progressBar').value = progress || 0;\n  document.getElementById('currentTime').textContent = formatDuration(audioPlayer.currentTime);\n  document.getElementById('totalTime').textContent = formatDuration(audioPlayer.duration);\n  \n  // Update mini player progress bar\n  const miniProgressFill = document.getElementById('miniProgressFill');\n  if (miniProgressFill) {\n    miniProgressFill.style.width = `${progress || 0}%`;\n  }\n}\n\n/**\n * Update play/pause button state\n */\nfunction updatePlayButton() {\n  const playPauseButton = document.getElementById('playPauseButton');\n  const miniPlayPause = document.getElementById('miniPlayPause');\n  \n  if (!playPauseButton || !miniPlayPause) return;\n  \n  const isPlaying = !audioPlayer.paused;\n  \n  if (isPlaying) {\n    playPauseButton.innerHTML = '<svg viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"32\" height=\"32\"><path d=\"M6 4h4v16H6zM14 4h4v16h-4z\"/></svg>';\n    miniPlayPause.innerHTML = '<svg viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"20\" height=\"20\"><path d=\"M6 4h4v16H6zM14 4h4v16h-4z\"/></svg>';\n  } else {\n    playPauseButton.innerHTML = '<svg viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"32\" height=\"32\"><path d=\"M8 5v14l11-7z\"/></svg>';\n    miniPlayPause.innerHTML = '<svg viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"20\" height=\"20\"><path d=\"M8 5v14l11-7z\"/></svg>';\n  }\n}\n\n/**\n * Update queue display (draggable reorder)\n */\nexport function updateQueue() {\n  const queueList = document.getElementById('queueList');\n  if (!queueList) return;\n\n  const toggleQueueExpanded = document.getElementById('toggleQueueExpanded');\n  if (toggleQueueExpanded) {\n    const needsToggle = playbackList.length > QUEUE_COLLAPSED_COUNT;\n    toggleQueueExpanded.style.display = needsToggle ? 'inline-flex' : 'none';\n    toggleQueueExpanded.textContent = isQueueExpanded ? 'Less' : 'More';\n    toggleQueueExpanded.setAttribute('aria-expanded', isQueueExpanded ? 'true' : 'false');\n  }\n\n  queueList.innerHTML = '';\n\n  if (!playbackList.length) {\n    queueList.innerHTML = '<p class=\"empty-queue\">Queue is empty</p>';\n    return;\n  }\n\n  let startIndex = 0;\n  let endIndex = playbackList.length;\n  if (!isQueueExpanded) {\n    const count = QUEUE_COLLAPSED_COUNT;\n    const current = Math.max(0, playbackIndex);\n    startIndex = Math.max(0, current - Math.floor(count / 2));\n    endIndex = Math.min(playbackList.length, startIndex + count);\n    startIndex = Math.max(0, endIndex - count);\n  }\n\n  for (let index = startIndex; index < endIndex; index++) {\n    const song = playbackList[index];\n    const item = document.createElement('div');\n    item.className = 'queue-item' + (index === playbackIndex ? ' active' : '');\n    item.dataset.playbackIndex = String(index);\n\n    const handle = document.createElement('div');\n    handle.className = 'queue-handle';\n    handle.textContent = '⋮⋮';\n    handle.draggable = !isCoarsePointer();\n    handle.setAttribute('aria-label', 'Drag to reorder');\n\n    if (isCoarsePointer()) {\n      handle.addEventListener('pointerdown', (event) => {\n        // Only handle touch/pen here; mouse uses HTML5 drag.\n        if (event.pointerType === 'mouse') return;\n        event.preventDefault();\n        startTouchQueueDrag(event, index, item, queueList);\n      }, { passive: false });\n    }\n\n    const meta = document.createElement('div');\n    meta.className = 'queue-meta';\n\n    const title = document.createElement('div');\n    title.className = 'queue-title';\n    title.textContent = song?.title || 'Unknown';\n\n    const artist = document.createElement('div');\n    artist.className = 'queue-artist';\n    artist.textContent = song?.artist || 'Unknown Artist';\n\n    meta.appendChild(title);\n    meta.appendChild(artist);\n\n    const removeBtn = document.createElement('button');\n    removeBtn.type = 'button';\n    removeBtn.className = 'queue-remove';\n    removeBtn.setAttribute('aria-label', 'Remove from queue');\n    removeBtn.textContent = '✕';\n\n    item.appendChild(handle);\n    item.appendChild(meta);\n    item.appendChild(removeBtn);\n\n    item.addEventListener('dblclick', () => {\n      if (!playbackList[index]) return;\n      setPlaybackIndex(index);\n      playSong(playbackList[index]);\n    });\n\n    handle.addEventListener('dragstart', (event) => {\n      draggingPlaybackIndex = index;\n      item.classList.add('is-dragging');\n      if (event.dataTransfer) {\n        event.dataTransfer.effectAllowed = 'move';\n        event.dataTransfer.setData('text/plain', String(index));\n      }\n    });\n\n    handle.addEventListener('dragend', () => {\n      draggingPlaybackIndex = null;\n      item.classList.remove('is-dragging');\n      queueList.querySelectorAll('.queue-item.is-drag-over').forEach((el) => {\n        el.classList.remove('is-drag-over');\n      });\n    });\n\n    removeBtn.addEventListener('click', (event) => {\n      event.preventDefault();\n      event.stopPropagation();\n\n      const result = removePlaybackItem(index);\n      if (!result) return;\n\n      if (result.removedWasCurrent) {\n        if (result.newIndex >= 0) {\n          playSong(playbackList[result.newIndex]);\n        } else {\n          // Queue is empty: stop playback.\n          if (audioPlayer) {\n            audioPlayer.pause();\n            audioPlayer.removeAttribute('src');\n            audioPlayer.load();\n          }\n          setIsPlaying(false);\n          updatePlayButton();\n          const npTitle = document.getElementById('npTitle');\n          const npArtist = document.getElementById('npArtist');\n          const miniTitle = document.getElementById('miniTitle');\n          const miniArtist = document.getElementById('miniArtist');\n          if (npTitle) npTitle.textContent = 'No song playing';\n          if (npArtist) npArtist.textContent = '';\n          if (miniTitle) miniTitle.textContent = 'No song playing';\n          if (miniArtist) miniArtist.textContent = '';\n\n          setMiniPlayerPresence(false);\n        }\n      }\n\n      updateQueue();\n    });\n\n    item.addEventListener('dragover', (event) => {\n      if (draggingPlaybackIndex == null) return;\n      event.preventDefault();\n      queueList.querySelectorAll('.queue-item.is-drag-over').forEach((el) => {\n        if (el !== item) el.classList.remove('is-drag-over');\n      });\n      item.classList.add('is-drag-over');\n    });\n\n    item.addEventListener('dragleave', () => {\n      item.classList.remove('is-drag-over');\n    });\n\n    item.addEventListener('drop', (event) => {\n      event.preventDefault();\n\n      let from = draggingPlaybackIndex;\n      if (from == null) {\n        const raw = event.dataTransfer?.getData('text/plain');\n        const num = Number(raw);\n        from = Number.isFinite(num) ? Math.trunc(num) : null;\n      }\n\n      const toTarget = Number(item.dataset.playbackIndex);\n      if (from == null || !Number.isFinite(toTarget)) return;\n\n      const rect = item.getBoundingClientRect();\n      const placeAfter = (event.clientY - rect.top) > rect.height / 2;\n      const to = computeDropToIndex(from, toTarget, placeAfter);\n\n      item.classList.remove('is-drag-over');\n      if (from === to) return;\n\n      movePlaybackItem(from, to);\n      updateQueue();\n    });\n\n    queueList.appendChild(item);\n  }\n}\n\n\n/**\n * Record a play to the server\n * @param {string} songId\n */\nasync function recordPlay(songId) {\n  try {\n    await recordPlayAPI(songId);\n  } catch (error) {\n    console.error('Error recording play:', error);\n  }\n}\n\n/**\n * Seek to position in current song\n * @param {number} percentage - 0-100\n */\nexport function seek(percentage) {\n  if (!audioPlayer) return;\n  const time = (percentage / 100) * audioPlayer.duration;\n  audioPlayer.currentTime = time;\n}\n\n/**\n * Set volume\n * @param {number} volume - 0-100\n */\nexport function setVolume(volume) {\n  if (!audioPlayer) return;\n  audioPlayer.volume = volume / 100;\n}\n\n/**\n * Get audio player reference\n * @returns {HTMLAudioElement}\n */\nexport function getAudioPlayer() {\n  return audioPlayer;\n}\n",
    "// UI Rendering Module\nimport { formatDuration, escapeHtml, setupLazyImages, lazyImageHtml } from './utils.js';\nimport { API_URL, songCoverUrl, albumCoverUrl, updatePlaylist } from './API.js';\n\n/**\n * Renders the song list\n * @param {Array<any>} songs - The list of songs to render\n * @param {Function} onPlaySong - Callback when play button is clicked\n */\nexport function renderSongs(songs, onPlaySong) {\n  const tbody = document.getElementById('songTableBody');\n\n  if (!tbody) return;\n\n  tbody.innerHTML = '';\n  \n  if (songs.length === 0) {\n    tbody.innerHTML = `\n    <tr>\n      <td colspan=\"8\" class=\"empty-state\">\n        <div class=\"empty-state-content\">\n          <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" width=\"64\" height=\"64\">\n            <path d=\"M9 18V5l12-2v13M9 18l-5 1V6l5-1M9 18l5-1m0-13V6\"/>\n          </svg>\n          <h3>No Songs Found</h3>\n          <p>Click \"Scan Library\" to add your music</p>\n        </div>\n      </td>\n    </tr>`;\n\n    return;\n  }\n  \n  songs.forEach((song, index) => {\n    const tr = document.createElement('tr');\n    const albumTitle = song.album || 'Unknown Album';\n    const truncatedAlbum = albumTitle.length > 30 ? albumTitle.substring(0, 30) + '...' : albumTitle;\n    const artistName = song.artist || 'Unknown Artist';\n    const playCount = song.playCount || 0;\n    const durationText = formatDuration(song.duration);\n    const copyText = `${song.title || 'Unknown'} — ${artistName}`;\n    tr.innerHTML = `\n      <td class=\"col-play\">\n        <button class=\"play-button\" data-index=\"${index}\">\n          <svg viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"16\" height=\"16\">\n            <path d=\"M8 5v14l11-7z\"/>\n          </svg>\n        </button>\n      </td>\n      <td class=\"col-cover\">\n        ${lazyImageHtml(songCoverUrl(song.id), song.title || 'Unknown', 'song-cover')}\n      </td>\n      <td class=\"col-title\">\n        <div class=\"song-title-row\">\n          <div class=\"song-title-text\">${escapeHtml(song.title || 'Unknown')}</div>\n          <div class=\"song-subtitle\">\n            <span class=\"song-sub-artist\">${escapeHtml(artistName)}</span>\n            <span class=\"song-sub-sep\">•</span>\n            <span class=\"song-sub-album\" title=\"${escapeHtml(albumTitle)}\">${escapeHtml(truncatedAlbum)}</span>\n            <span class=\"song-sub-sep\">•</span>\n            <span class=\"song-sub-plays\">${playCount} plays</span>\n          </div>\n        </div>\n      </td>\n      <td class=\"col-artist\">${escapeHtml(artistName)}</td>\n      <td class=\"col-album\" title=\"${escapeHtml(albumTitle)}\">${escapeHtml(truncatedAlbum)}</td>\n      <td class=\"col-duration\">${escapeHtml(durationText)}</td>\n      <td class=\"col-plays\">${playCount}</td>\n      <td class=\"col-add\">\n        <div class=\"dropdown\">\n          <button class=\"dropdown-trigger is-compact\" type=\"button\" data-dropdown-trigger aria-haspopup=\"menu\" aria-expanded=\"false\" title=\"Song actions\">\n            <svg viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"18\" height=\"18\" aria-hidden=\"true\">\n              <circle cx=\"5\" cy=\"12\" r=\"1.8\" />\n              <circle cx=\"12\" cy=\"12\" r=\"1.8\" />\n              <circle cx=\"19\" cy=\"12\" r=\"1.8\" />\n            </svg>\n          </button>\n          <div class=\"dropdown-menu\" role=\"menu\">\n            <button class=\"dropdown-item song-row-play-btn\" type=\"button\">Play</button>\n            <button class=\"dropdown-item song-row-play-next-btn\" type=\"button\" data-song-id=\"${song.id}\" data-song-index=\"${index}\" data-song-context=\"library\">Play next</button>\n            <button class=\"dropdown-item song-row-queue-btn\" type=\"button\" data-song-id=\"${song.id}\" data-song-index=\"${index}\" data-song-context=\"library\">Add to queue</button>\n            <div class=\"dropdown-sep\" role=\"separator\"></div>\n            <button class=\"dropdown-item add-to-playlist-btn\" type=\"button\" data-song-id=\"${song.id}\">Add to playlist</button>\n            <button class=\"dropdown-item song-copy-btn\" type=\"button\" data-copy-text=\"${escapeHtml(copyText)}\">Copy title + artist</button>\n          </div>\n        </div>\n      </td>\n    `;\n    \n    // Add event listeners\n    tr.querySelector('.play-button').addEventListener('click', () => onPlaySong(index));\n    tr.querySelector('.song-row-play-btn')?.addEventListener('click', () => onPlaySong(index));\n    tr.addEventListener('dblclick', () => onPlaySong(index));\n    \n    tbody.appendChild(tr);\n  });\n  \n  // Setup lazy loading for newly added images\n  setupLazyImages(tbody);\n}\n\n/**\n * Render albums grid\n * @param {Array<any>} albums - The list of albums\n * @param {Function} onAlbumClick - Callback when album is clicked\n */\nexport function renderAlbums(albums, onAlbumClick) {\n  const grid = document.getElementById('albumGrid');\n  if (!grid) return;\n  \n  grid.innerHTML = '';\n  \n  if (albums.length === 0) {\n    grid.innerHTML = `<div class=\"empty-state-content\">\n      <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" width=\"64\" height=\"64\">\n        <circle cx=\"12\" cy=\"12\" r=\"10\"/>\n        <circle cx=\"12\" cy=\"12\" r=\"3\"/>\n      </svg>\n      <h3>No Albums Found</h3>\n      <p>Your albums will appear here once you scan your library</p>\n    </div>`;\n    return;\n  }\n  \n  albums.forEach(album => {\n    const card = document.createElement('div');\n    card.className = 'album-card';\n    const coverUrl = album.songs && album.songs[0] ? albumCoverUrl(album.songs[0].id) : '';\n    const albumTitle = album.album || 'Unknown Album';\n    const truncatedTitle = albumTitle.length > 25 ? albumTitle.substring(0, 25) + '...' : albumTitle;\n    card.innerHTML = `\n      <div class=\"album-cover-wrapper\">\n        ${coverUrl ? lazyImageHtml(coverUrl, albumTitle, 'album-artwork') : ''}\n        <div class=\"album-placeholder\">\n          <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" width=\"48\" height=\"48\">\n            <circle cx=\"12\" cy=\"12\" r=\"10\"/>\n            <circle cx=\"12\" cy=\"12\" r=\"3\"/>\n          </svg>\n        </div>\n      </div>\n      <h3 title=\"${escapeHtml(albumTitle)}\">${escapeHtml(truncatedTitle)}</h3>\n      <p>${escapeHtml(album.artist || 'Unknown Artist')}</p>\n      <p style=\"font-size: 12px; margin-top: 4px;\">${album.songCount} songs</p>\n    `;\n    card.addEventListener('click', () => onAlbumClick(album.artist, album.album));\n    grid.appendChild(card);\n  });\n  \n  // Setup lazy loading for album artwork\n  setupLazyImages(grid);\n}\n\n/**\n * Render album detail view\n * @param {any} album - The album data\n * @param {Function} onPlaySong - Callback when song is played\n */\nexport function renderAlbumDetail(album, onPlaySong) {\n  document.getElementById('albumTitle').textContent = album.album;\n  document.getElementById('albumArtist').textContent = album.artist;\n  document.getElementById('albumMeta').textContent = `${album.year || 'Unknown Year'} • ${album.songs.length} songs • ${formatDuration(album.duration)}`;\n  \n  // Set album artwork\n  const albumArtwork = document.getElementById('albumArtwork');\n  albumArtwork.style.display = 'block';\n  if (album.songs && album.songs[0]) {\n    albumArtwork.onerror = () => {\n      albumArtwork.style.display = 'none';\n    };\n    albumArtwork.src = albumCoverUrl(album.songs[0].id);\n  } else {\n    albumArtwork.style.display = 'none';\n  }\n  \n  const tbody = document.getElementById('albumSongTableBody');\n  tbody.innerHTML = '';\n  \n  album.songs.forEach((song, index) => {\n    const tr = document.createElement('tr');\n    tr.innerHTML = `\n      <td class=\"col-track\">${song.trackNumber || '-'}</td>\n      <td class=\"col-play\">\n        <button class=\"play-button\" data-index=\"${index}\">\n          <svg viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"16\" height=\"16\">\n            <path d=\"M8 5v14l11-7z\"/>\n          </svg>\n        </button>\n      </td>\n      <td class=\"col-title\">${escapeHtml(song.title)}</td>\n      <td class=\"col-duration\">${formatDuration(song.duration)}</td>\n    `;\n    \n    tr.querySelector('.play-button').addEventListener('click', () => onPlaySong(index));\n    tr.addEventListener('dblclick', () => onPlaySong(index));\n    \n    tbody.appendChild(tr);\n  });\n}\n\n/**\n * Render artists list\n * @param {Array<any>} artists - The list of artists\n * @param {Function} onArtistClick - Callback when artist is clicked\n */\nexport function renderArtists(artists, onArtistClick) {\n  const list = document.getElementById('artistList');\n  if (!list) return;\n  \n  list.innerHTML = '';\n  \n  if (artists.length === 0) {\n    list.innerHTML = `<div class=\"empty-state-content\">\n      <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" width=\"64\" height=\"64\">\n        <path d=\"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2\"/>\n        <circle cx=\"12\" cy=\"7\" r=\"4\"/>\n      </svg>\n      <h3>No Artists Found</h3>\n      <p>Artists will appear here after scanning your music</p>\n    </div>`;\n    return;\n  }\n  \n  artists.forEach(artist => {\n    const item = document.createElement('div');\n    item.className = 'artist-item';\n    item.innerHTML = `\n      <div>\n        <div class=\"artist-name\">${escapeHtml(artist.name)}</div>\n        <div class=\"artist-meta\">${artist.songCount} songs • ${artist.albumCount} albums</div>\n      </div>\n    `;\n    item.addEventListener('click', () => onArtistClick(artist.name));\n    list.appendChild(item);\n  });\n}\n\n/**\n * Render playlists grid\n * @param {Array<any>} playlists - The list of playlists\n */\nexport function renderPlaylists(playlists) {\n  const grid = document.getElementById('playlistGrid');\n  if (!grid) return;\n  \n  grid.innerHTML = '';\n  \n  if (!playlists || playlists.length === 0) {\n    grid.innerHTML = `\n      <div class=\"empty-state-content\">\n        <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" width=\"64\" height=\"64\">\n          <path d=\"M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z\"/>\n        </svg>\n        <h3>No Playlists Yet</h3>\n        <p>Create your first playlist to organize your music</p>\n      </div>`;\n    return;\n  }\n  \n  (playlists || []).forEach(playlist => {\n    const card = document.createElement('div');\n    card.className = 'playlist-card';\n    card.dataset.playlistId = playlist.id;\n    card.dataset.pinned = playlist.pinned ? '1' : '0';\n    card.innerHTML = `\n      <button class=\"playlist-pin-btn\" type=\"button\" data-playlist-id=\"${playlist.id}\" data-pinned=\"${playlist.pinned ? '1' : '0'}\" aria-label=\"${playlist.pinned ? 'Unpin playlist' : 'Pin playlist'}\" title=\"${playlist.pinned ? 'Pinned' : 'Pin'}\">\n        <svg viewBox=\"0 0 24 24\" fill=\"${playlist.pinned ? 'currentColor' : 'none'}\" stroke=\"currentColor\" stroke-width=\"2\" width=\"18\" height=\"18\">\n          <path d=\"M12 17l-5 3 1.5-5.5L4 10.5l5.7-.4L12 5l2.3 5.1 5.7.4-4.5 4 1.5 5.5z\"/>\n        </svg>\n      </button>\n      <div class=\"playlist-cover\">\n        <svg viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"48\" height=\"48\">\n          <path d=\"M15 6H3v2h12V6zm0 4H3v2h12v-2zM3 16h8v-2H3v2zM17 6v8.18c-.31-.11-.65-.18-1-.18-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3V8h3V6h-5z\"/>\n        </svg>\n      </div>\n      <div class=\"playlist-info\">\n        <h3>${escapeHtml(playlist.name)}</h3>\n        <p>${playlist.songCount || 0} songs</p>\n      </div>\n    `;\n    \n    card.addEventListener('click', () => {\n      if (window.loadPlaylistDetail) {\n        window.loadPlaylistDetail(playlist.id);\n      }\n    });\n    \n    grid.appendChild(card);\n  });\n}\n\n/**\n * Render statistics\n * @param {any} stats - The statistics data\n */\nexport function renderStats(stats) {\n  const layout = document.getElementById('statsLayout');\n  if (!layout) return;\n  \n  // Check if we have any data\n  const hasData = stats && stats.totalSongs > 0;\n  \n  if (!hasData) {\n    layout.innerHTML = `<div class=\"empty-state-content\" style=\"grid-column: 1 / -1;\">\n      <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" width=\"64\" height=\"64\">\n        <path d=\"M3 3v18h18\"/>\n        <path d=\"M7 16V9M12 16V6M17 16v-4\"/>\n      </svg>\n      <h3>No Statistics Yet</h3>\n      <p>Start playing some music to see your stats</p>\n    </div>`;\n    return;\n  }\n\n  const PREVIEW_COUNT = 5;\n  const mostPlayedPreview = (stats.mostPlayed || []).slice(0, PREVIEW_COUNT);\n  const recentlyPlayedPreview = (stats.recentlyPlayed || []).slice(0, PREVIEW_COUNT);\n  const listeningTimeLabel = formatDurationLong(stats.totalListeningTime || 0);\n\n  layout.innerHTML = `\n    <div class=\"stat-tile tile-most\" role=\"button\" tabindex=\"0\" aria-label=\"Most Played Songs\" data-stats-action=\"modal\" data-stats-modal=\"mostPlayed\">\n      <div class=\"stat-tile-header\">\n        <div class=\"stat-tile-title\">Most Played</div>\n        <div class=\"stat-tile-hint\">Open list</div>\n      </div>\n      <div class=\"stat-preview\">\n        ${mostPlayedPreview.length ? mostPlayedPreview.map(song => `\n          <div class=\"stat-preview-item\">\n            <div style=\"min-width: 0;\">\n              <div class=\"stat-preview-primary\">${escapeHtml(song.title || 'Unknown')}</div>\n              <div class=\"stat-preview-secondary\">${escapeHtml(song.artist || 'Unknown Artist')}</div>\n            </div>\n            <div class=\"stat-preview-right\">${song.playCount || 0} plays</div>\n          </div>\n        `).join('') : `\n          <div class=\"stat-preview-item\">\n            <div style=\"min-width: 0;\">\n              <div class=\"stat-preview-primary\">No plays recorded</div>\n              <div class=\"stat-preview-secondary\">Play some music to populate this</div>\n            </div>\n          </div>\n        `}\n      </div>\n    </div>\n\n    <div class=\"stat-tile tile-songs\" role=\"button\" tabindex=\"0\" aria-label=\"Open Songs\" data-stats-action=\"navigate\" data-stats-target=\"library\">\n      <div class=\"stat-tile-header\">\n        <div class=\"stat-tile-title\">Songs</div>\n        <div class=\"stat-tile-value\">${stats.totalSongs || 0}</div>\n      </div>\n      <div class=\"stat-tile-hint\">Open songs</div>\n    </div>\n\n    <div class=\"stat-tile tile-artists\" role=\"button\" tabindex=\"0\" aria-label=\"Open Artists\" data-stats-action=\"navigate\" data-stats-target=\"artists\">\n      <div class=\"stat-tile-header\">\n        <div class=\"stat-tile-title\">Artists</div>\n        <div class=\"stat-tile-value\">${stats.uniqueArtists || 0}</div>\n      </div>\n      <div class=\"stat-tile-hint\">Open artists</div>\n    </div>\n\n    <div class=\"stat-tile tile-albums\" role=\"button\" tabindex=\"0\" aria-label=\"Open Albums\" data-stats-action=\"navigate\" data-stats-target=\"albums\">\n      <div class=\"stat-tile-header\">\n        <div class=\"stat-tile-title\">Albums</div>\n        <div class=\"stat-tile-value\">${stats.uniqueAlbums || 0}</div>\n      </div>\n      <div class=\"stat-tile-hint\">Open albums</div>\n    </div>\n\n    <div class=\"stat-tile tile-playlists\" role=\"button\" tabindex=\"0\" aria-label=\"Open Playlists\" data-stats-action=\"navigate\" data-stats-target=\"playlists\">\n      <div class=\"stat-tile-header\">\n        <div class=\"stat-tile-title\">Playlists</div>\n        <div class=\"stat-tile-value\">${stats.totalPlaylists || 0}</div>\n      </div>\n      <div class=\"stat-tile-hint\">Open playlists</div>\n    </div>\n\n    <div class=\"stat-tile tile-genres\" role=\"button\" tabindex=\"0\" aria-label=\"Genres\" data-stats-action=\"modal\" data-stats-modal=\"genres\">\n      <div class=\"stat-tile-header\">\n        <div class=\"stat-tile-title\">Genres</div>\n        <div class=\"stat-tile-value\">${stats.uniqueGenres || 0}</div>\n      </div>\n      <div class=\"stat-tile-hint\">Open list</div>\n    </div>\n\n    <div class=\"stat-tile tile-totals\" role=\"button\" tabindex=\"0\" aria-label=\"Totals\" data-stats-action=\"modal\" data-stats-modal=\"summary\">\n      <div class=\"stat-tile-header\">\n        <div class=\"stat-tile-title\">Totals</div>\n        <div class=\"stat-tile-value\">${stats.totalPlays || 0}</div>\n      </div>\n      <div class=\"stat-tile-hint\">Listening: ${escapeHtml(listeningTimeLabel)} • ${escapeHtml(formatDuration(stats.totalDuration || 0))} library • open details</div>\n    </div>\n\n    <div class=\"stat-tile tile-recent\" role=\"button\" tabindex=\"0\" aria-label=\"Recently Played\" data-stats-action=\"modal\" data-stats-modal=\"recentlyPlayed\">\n      <div class=\"stat-tile-header\">\n        <div class=\"stat-tile-title\">Recently Played</div>\n        <div class=\"stat-tile-hint\">Open list</div>\n      </div>\n      <div class=\"stat-preview\">\n        ${recentlyPlayedPreview.length ? recentlyPlayedPreview.map(play => {\n          const timeAgo = play.playedAt ? getTimeAgo(new Date(play.playedAt)) : '';\n          return `\n            <div class=\"stat-preview-item\">\n              <div style=\"min-width: 0;\">\n                <div class=\"stat-preview-primary\">${escapeHtml(play.title || 'Unknown')}</div>\n                <div class=\"stat-preview-secondary\">${escapeHtml(play.artist || 'Unknown Artist')}</div>\n              </div>\n              <div class=\"stat-preview-right\">${escapeHtml(timeAgo)}</div>\n            </div>\n          `;\n        }).join('') : `\n          <div class=\"stat-preview-item\">\n            <div style=\"min-width: 0;\">\n              <div class=\"stat-preview-primary\">No recent plays</div>\n              <div class=\"stat-preview-secondary\">Start playing music to populate this</div>\n            </div>\n          </div>\n        `}\n      </div>\n    </div>\n  `;\n}\n\nfunction formatDurationLong(seconds) {\n  const totalSeconds = Number(seconds);\n  if (!Number.isFinite(totalSeconds) || totalSeconds <= 0) return '0m';\n\n  const totalMinutes = Math.floor(totalSeconds / 60);\n  const mins = totalMinutes % 60;\n  const totalHours = Math.floor(totalMinutes / 60);\n  const hours = totalHours % 24;\n  const days = Math.floor(totalHours / 24);\n\n  if (days > 0) return `${days}d ${hours}h`;\n  if (totalHours > 0) return `${totalHours}h ${mins}m`;\n  return `${totalMinutes}m`;\n}\n\nfunction getTimeAgo(date) {\n  const seconds = Math.floor((new Date() - date) / 1000);\n  if (seconds < 60) return 'Just now';\n  const minutes = Math.floor(seconds / 60);\n  if (minutes < 60) return `${minutes}m ago`;\n  const hours = Math.floor(minutes / 60);\n  if (hours < 24) return `${hours}h ago`;\n  const days = Math.floor(hours / 24);\n  return `${days}d ago`;\n}\n\nexport function renderPlaylistDetail(playlist, songs) {\n  const nameEl = document.getElementById('playlistDetailName');\n  const descEl = document.getElementById('playlistDetailDescription');\n  const tbody = document.getElementById('playlistDetailTableBody');\n  \n  if (!tbody || !nameEl || !descEl) return;\n  \n  // Set playlist info\n  nameEl.textContent = playlist.name || 'Untitled Playlist';\n  const songCountLabel = `${(songs || []).length} songs`;\n  const desc = String(playlist.description || '').trim();\n  descEl.textContent = desc ? `${desc} • ${songCountLabel}` : songCountLabel;\n  \n  // Clear table\n  tbody.innerHTML = '';\n  \n  // Empty state\n  if (!songs || songs.length === 0) {\n    tbody.innerHTML = `\n      <tr>\n        <td colspan=\"8\" class=\"empty-state\">\n          <div class=\"empty-state-content\">\n            <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" width=\"64\" height=\"64\">\n              <path d=\"M9 18V5l12-2v13\"/>\n              <circle cx=\"6\" cy=\"18\" r=\"3\"/>\n              <circle cx=\"18\" cy=\"16\" r=\"3\"/>\n            </svg>\n            <h3>No Songs in This Playlist</h3>\n            <p>Add songs using the + button in your library</p>\n          </div>\n        </td>\n      </tr>`;\n    return;\n  }\n  \n  // Render each song\n  songs.forEach((song, index) => {\n    const tr = document.createElement('tr');\n    const albumTitle = song.album || 'Unknown Album';\n    const truncatedAlbum = albumTitle.length > 30 ? albumTitle.substring(0, 30) + '...' : albumTitle;\n    const artistName = song.artist || 'Unknown Artist';\n    const copyText = `${song.title || 'Unknown'} — ${artistName}`;\n    \n    tr.innerHTML = `\n      <td class=\"col-drag\">\n        <span class=\"playlist-drag-handle\" draggable=\"true\" aria-label=\"Drag to reorder\">⋮⋮</span>\n      </td>\n      <td class=\"col-play\">\n        <button class=\"play-button\" data-index=\"${index}\">\n          <svg viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"16\" height=\"16\">\n            <path d=\"M8 5v14l11-7z\"/>\n          </svg>\n        </button>\n      </td>\n      <td class=\"col-cover\">\n        <img class=\"song-cover\" src=\"${songCoverUrl(song.id)}\" alt=\"${escapeHtml(song.title || 'Unknown')}\" onerror=\"this.style.display='none';\" />\n      </td>\n      <td class=\"col-title\">${escapeHtml(song.title || 'Unknown')}</td>\n      <td class=\"col-artist\">${escapeHtml(artistName)}</td>\n      <td class=\"col-album\" title=\"${escapeHtml(albumTitle)}\">${escapeHtml(truncatedAlbum)}</td>\n      <td class=\"col-duration\">${formatDuration(song.duration)}</td>\n      <td class=\"col-remove\">\n        <div class=\"dropdown\">\n          <button class=\"dropdown-trigger is-compact\" type=\"button\" data-dropdown-trigger aria-haspopup=\"menu\" aria-expanded=\"false\" title=\"Song actions\">\n            <svg viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"18\" height=\"18\" aria-hidden=\"true\">\n              <circle cx=\"5\" cy=\"12\" r=\"1.8\" />\n              <circle cx=\"12\" cy=\"12\" r=\"1.8\" />\n              <circle cx=\"19\" cy=\"12\" r=\"1.8\" />\n            </svg>\n          </button>\n          <div class=\"dropdown-menu\" role=\"menu\">\n            <button class=\"dropdown-item song-row-play-btn\" type=\"button\">Play</button>\n            <button class=\"dropdown-item song-row-play-next-btn\" type=\"button\" data-song-id=\"${song.id}\" data-song-index=\"${index}\" data-song-context=\"playlist\">Play next</button>\n            <button class=\"dropdown-item song-row-queue-btn\" type=\"button\" data-song-id=\"${song.id}\" data-song-index=\"${index}\" data-song-context=\"playlist\">Add to queue</button>\n            <div class=\"dropdown-sep\" role=\"separator\"></div>\n            <button class=\"dropdown-item add-to-playlist-btn\" type=\"button\" data-song-id=\"${song.id}\">Add to playlist</button>\n            <button class=\"dropdown-item song-copy-btn\" type=\"button\" data-copy-text=\"${escapeHtml(copyText)}\">Copy title + artist</button>\n            <div class=\"dropdown-sep\" role=\"separator\"></div>\n            <button class=\"dropdown-item is-danger remove-from-playlist-btn\" type=\"button\" data-song-id=\"${song.id}\">Remove from playlist</button>\n          </div>\n        </div>\n      </td>\n    `;\n    \n    tbody.appendChild(tr);\n  });\n  \n  // Add play button handlers\n  tbody.querySelectorAll('.play-button').forEach(btn => {\n    btn.addEventListener('click', (e) => {\n      e.stopPropagation();\n      const index = parseInt(btn.dataset.index);\n      if (window.onPlaySongFromPlaylist) {\n        window.onPlaySongFromPlaylist(songs, index);\n      }\n    });\n  });\n\n  tbody.querySelectorAll('.song-row-play-btn').forEach(btn => {\n    btn.addEventListener('click', (e) => {\n      e.stopPropagation();\n      const row = btn.closest('tr');\n      const playBtn = row?.querySelector?.('.play-button');\n      const index = parseInt(playBtn?.dataset?.index);\n      if (!Number.isFinite(index)) return;\n      if (window.onPlaySongFromPlaylist) {\n        window.onPlaySongFromPlaylist(songs, index);\n      }\n    });\n  });\n\n  // Drag-and-drop reordering (handle-only)\n  let draggingIndex = null;\n\n  function computeDropToIndex(fromIndex, targetIndex, placeAfter) {\n    let to = targetIndex + (placeAfter ? 1 : 0);\n    if (fromIndex < to) to -= 1;\n    return to;\n  }\n\n  function buildSongIdsFromSongs(list) {\n    return list.map(s => s.id).filter(Boolean);\n  }\n\n  tbody.querySelectorAll('tr').forEach((row, rowIndex) => {\n    const handle = row.querySelector('.playlist-drag-handle');\n    if (!handle) return;\n\n    handle.addEventListener('dragstart', (event) => {\n      draggingIndex = rowIndex;\n      row.classList.add('is-dragging');\n      if (event.dataTransfer) {\n        event.dataTransfer.effectAllowed = 'move';\n        event.dataTransfer.setData('text/plain', String(rowIndex));\n      }\n    });\n\n    handle.addEventListener('dragend', () => {\n      draggingIndex = null;\n      tbody.querySelectorAll('tr.is-dragging').forEach(el => el.classList.remove('is-dragging'));\n      tbody.querySelectorAll('tr.is-drag-over').forEach(el => el.classList.remove('is-drag-over'));\n    });\n\n    row.addEventListener('dragover', (event) => {\n      if (draggingIndex == null) return;\n      event.preventDefault();\n      tbody.querySelectorAll('tr.is-drag-over').forEach(el => {\n        if (el !== row) el.classList.remove('is-drag-over');\n      });\n      row.classList.add('is-drag-over');\n    });\n\n    row.addEventListener('dragleave', () => {\n      row.classList.remove('is-drag-over');\n    });\n\n    row.addEventListener('drop', async (event) => {\n      event.preventDefault();\n\n      let from = draggingIndex;\n      if (from == null) {\n        const raw = event.dataTransfer?.getData('text/plain');\n        const num = Number(raw);\n        from = Number.isFinite(num) ? Math.trunc(num) : null;\n      }\n      if (from == null) return;\n\n      const toTarget = rowIndex;\n      const rect = row.getBoundingClientRect();\n      const placeAfter = (event.clientY - rect.top) > rect.height / 2;\n      const to = computeDropToIndex(from, toTarget, placeAfter);\n\n      row.classList.remove('is-drag-over');\n      if (from === to) return;\n\n      const nextSongs = [...songs];\n      const [moved] = nextSongs.splice(from, 1);\n      nextSongs.splice(to, 0, moved);\n\n      const nextSongIds = buildSongIdsFromSongs(nextSongs);\n\n      // Update globals used elsewhere in the app.\n      if (window.currentPlaylistId === playlist.id) {\n        window.currentPlaylistSongs = nextSongs;\n      }\n\n      // Optimistically re-render, then persist.\n      renderPlaylistDetail({ ...playlist, songIds: nextSongIds }, nextSongs);\n\n      try {\n        await updatePlaylist(playlist.id, { songIds: nextSongIds });\n      } catch (error) {\n        console.error('Failed to persist playlist order:', error);\n        // Reload to recover correct state.\n        if (window.loadPlaylistDetail) {\n          await window.loadPlaylistDetail(playlist.id);\n        }\n      }\n    });\n  });\n}\n\n",
    "import { fetchAllSongs } from '../API.js';\nimport { currentSongs, setCurrentSongs, setPlaybackList, setShuffleEnabled, setRepeatMode } from '../state.js';\nimport { playSong } from '../player.js';\nimport { renderSongs } from '../ui.js';\n\nexport function playSongFromList(index) {\n  setPlaybackList([...currentSongs], index);\n  playSong(currentSongs[index]);\n}\n\nexport function playAll() {\n  setShuffleEnabled(false);\n  setRepeatMode('off');\n  setPlaybackList([...currentSongs], 0);\n  playSong(currentSongs[0]);\n}\n\nexport function shuffleAll() {\n  setShuffleEnabled(true);\n  setRepeatMode('off');\n  const shuffled = [...currentSongs].sort(() => Math.random() - 0.5);\n  setPlaybackList(shuffled, 0);\n  playSong(shuffled[0]);\n}\n\nexport async function loadSongs() {\n  try {\n    const songs = await fetchAllSongs();\n    setCurrentSongs(songs);\n    renderSongs(songs, playSongFromList);\n\n    const playAllBtn = document.getElementById('playAll');\n    const shuffleAllBtn = document.getElementById('shuffleAll');\n    if (playAllBtn) playAllBtn.onclick = () => playAll();\n    if (shuffleAllBtn) shuffleAllBtn.onclick = () => shuffleAll();\n  } catch (error) {\n    console.error('Error loading songs:', error);\n  }\n}\n\n// Backwards compatibility (used by some UI renderers)\nwindow.playSongFromList = playSongFromList;\n",
    "import { getAlbumDetail, listAlbums } from '../API.js';\nimport { currentSongs, setPlaybackList, setShuffleEnabled, setRepeatMode } from '../state.js';\nimport { playSong } from '../player.js';\nimport { renderAlbumDetail, renderAlbums } from '../ui.js';\nimport { switchView } from './views.js';\n\nlet currentAlbumSongs = [];\n\nexport function playAlbumSong(index) {\n  setPlaybackList([...currentAlbumSongs], index);\n  playSong(currentAlbumSongs[index]);\n}\n\nfunction playAlbumAll() {\n  setShuffleEnabled(false);\n  setRepeatMode('off');\n  setPlaybackList([...currentAlbumSongs], 0);\n  playSong(currentAlbumSongs[0]);\n}\n\nfunction shuffleAlbum() {\n  setShuffleEnabled(true);\n  setRepeatMode('off');\n  const shuffled = [...currentAlbumSongs].sort(() => Math.random() - 0.5);\n  setPlaybackList(shuffled, 0);\n  playSong(shuffled[0]);\n}\n\nexport async function loadAlbums() {\n  try {\n    const albums = await listAlbums();\n    renderAlbums(albums, loadAlbumDetail);\n  } catch (error) {\n    console.error('Error loading albums:', error);\n  }\n}\n\nexport async function loadAlbumDetail(artist, album) {\n  try {\n    const albumData = await getAlbumDetail(artist, album);\n    currentAlbumSongs = albumData.songs;\n\n    await switchView('albumDetailView', false);\n    window.location.hash = `#/album/${encodeURIComponent(artist)}/${encodeURIComponent(album)}`;\n    await new Promise(resolve => setTimeout(resolve, 0));\n\n    renderAlbumDetail(albumData, playAlbumSong);\n\n    const playBtn = document.getElementById('playAlbum');\n    const shuffleBtn = document.getElementById('shuffleAlbum');\n    const backBtn = document.getElementById('backToAlbums');\n\n    if (playBtn) playBtn.onclick = () => playAlbumAll();\n    if (shuffleBtn) shuffleBtn.onclick = () => shuffleAlbum();\n    if (backBtn) {\n      backBtn.onclick = () => {\n        window.location.hash = '#/albums';\n      };\n    }\n  } catch (error) {\n    console.error('Error loading album detail:', error);\n  }\n}\n\n// Backwards compatibility\nwindow.playAlbumSong = playAlbumSong;\n",
    "import { debounce } from '../utils.js';\nimport { advancedSearch as AdvancedSearchAPI, fetchAllSongs, simpleSearch, getSearchSuggestions } from '../API.js';\nimport { setCurrentSongs } from '../state.js';\nimport { renderSongs } from '../ui.js';\nimport { switchView } from './views.js';\nimport { playSongFromList } from './library.js';\n\nconst searchInput = document.getElementById('searchInput');\nconst advancedSearchEl = document.getElementById('advancedSearch');\nconst advancedSearchToggle = document.getElementById('advancedSearchToggle');\n\n// Autocomplete elements\nlet suggestionsDropdown = null;\nlet selectedSuggestionIndex = -1;\nlet currentSuggestions = [];\n\nfunction setAdvancedSearchVisible(visible) {\n  if (!advancedSearchEl || !advancedSearchToggle) return;\n  advancedSearchEl.style.display = visible ? 'block' : 'none';\n  advancedSearchToggle.classList.toggle('active', visible);\n}\n\nfunction isAdvancedSearchVisible() {\n  return Boolean(advancedSearchEl && advancedSearchEl.style.display === 'block');\n}\n\nexport function setupSearch() {\n  const searchButton = document.querySelector('.search-button');\n  if (!searchInput || !searchButton || !advancedSearchToggle || !advancedSearchEl) return;\n\n  // Create suggestions dropdown\n  createSuggestionsDropdown();\n\n  searchInput.addEventListener('input', debounce(handleSearchInput, 150));\n  searchInput.addEventListener('keydown', handleSearchKeydown);\n  searchInput.addEventListener('keypress', (e) => {\n    if (e.key === 'Enter') {\n      hideSuggestions();\n      void performSearch();\n    }\n  });\n  \n  searchInput.addEventListener('focus', () => {\n    if (searchInput.value.trim().length >= 2 && currentSuggestions.length > 0) {\n      showSuggestions();\n    }\n  });\n\n  searchButton.addEventListener('click', () => {\n    hideSuggestions();\n    void performSearch();\n  });\n\n  advancedSearchToggle.addEventListener('click', () => {\n    setAdvancedSearchVisible(!isAdvancedSearchVisible());\n  });\n\n  // Close the panel when focus moves anywhere outside it.\n  document.addEventListener('focusin', (event) => {\n    if (!isAdvancedSearchVisible()) return;\n\n    const target = event.target;\n    if (!target) return;\n\n    if (advancedSearchEl.contains(target)) return;\n    if (advancedSearchToggle === target || advancedSearchToggle.contains(target)) return;\n\n    setAdvancedSearchVisible(false);\n  });\n\n  // Also close on pointer interactions outside (covers clicks on non-focusable elements).\n  document.addEventListener('pointerdown', (event) => {\n    if (!isAdvancedSearchVisible()) return;\n\n    const target = event.target;\n    if (!target) return;\n\n    if (advancedSearchEl.contains(target)) return;\n    if (advancedSearchToggle === target || advancedSearchToggle.contains(target)) return;\n\n    setAdvancedSearchVisible(false);\n  }, true);\n\n  document.getElementById('applyFilters')?.addEventListener('click', () => {\n    void applyAdvancedSearch();\n  });\n  document.getElementById('clearFilters')?.addEventListener('click', () => {\n    void clearFilters();\n  });\n\n  document.getElementById('discoveryNotPlayed')?.addEventListener('click', () => {\n    void runDiscoveryNotPlayedRecently();\n  });\n  document.getElementById('discoveryLowPlays')?.addEventListener('click', () => {\n    void runDiscoveryLowPlayCount();\n  });\n}\n\nfunction normalizeText(text) {\n  return String(text || '')\n    .toLowerCase()\n    .normalize('NFKD')\n    .replace(/[\\u0300-\\u036f]/g, '')\n    .replace(/[^a-z0-9\\s]/g, ' ')\n    .replace(/\\s+/g, ' ')\n    .trim();\n}\n\nfunction fuzzyScore(query, haystack) {\n  if (!query) return -1;\n  const q = normalizeText(query);\n  const h = normalizeText(haystack);\n  if (!q || !h) return -1;\n\n  const tokens = q.split(' ').filter(Boolean);\n  let total = 0;\n  for (const token of tokens) {\n    const idx = h.indexOf(token);\n    if (idx >= 0) {\n      total += 100 - Math.min(80, idx);\n      continue;\n    }\n\n    let pos = 0;\n    let gaps = 0;\n    for (const ch of token) {\n      const found = h.indexOf(ch, pos);\n      if (found === -1) return -1;\n      gaps += Math.max(0, found - pos);\n      pos = found + 1;\n    }\n    total += Math.max(5, 60 - Math.min(55, gaps));\n  }\n  return total;\n}\n\nexport async function ensureLibraryViewForResults() {\n  if (!document.getElementById('songTableBody')) {\n    await switchView('library', false);\n    await new Promise(resolve => setTimeout(resolve, 0));\n  }\n}\n\nexport async function performSearch() {\n  if (!searchInput) return;\n  const query = searchInput.value.trim();\n\n  await ensureLibraryViewForResults();\n\n  if (!query) {\n    const songs = await fetchAllSongs();\n    setCurrentSongs(songs);\n    renderSongs(songs, playSongFromList);\n    return;\n  }\n\n  try {\n    const songs = await simpleSearch(query);\n    if (songs.length > 0) {\n      setCurrentSongs(songs);\n      renderSongs(songs, playSongFromList);\n      return;\n    }\n\n    const all = await fetchAllSongs();\n    const scored = all\n      .map(song => {\n        const haystack = `${song.title || ''} ${song.artist || ''} ${song.album || ''} ${song.genre || ''}`;\n        return { song, score: fuzzyScore(query, haystack) };\n      })\n      .filter(x => x.score >= 0)\n      .sort((a, b) => b.score - a.score)\n      .slice(0, 300)\n      .map(x => x.song);\n\n    setCurrentSongs(scored);\n    renderSongs(scored, playSongFromList);\n  } catch (error) {\n    console.error('Search error:', error);\n  }\n}\n\nasync function applyAdvancedSearch() {\n  await ensureLibraryViewForResults();\n  const artist = document.getElementById('filterArtist')?.value;\n  const album = document.getElementById('filterAlbum')?.value;\n  const genre = document.getElementById('filterGenre')?.value;\n  const year = document.getElementById('filterYear')?.value;\n\n  try {\n    const songs = await AdvancedSearchAPI({ artist, album, genre, year });\n    setCurrentSongs(songs);\n    renderSongs(songs, playSongFromList);\n  } catch (error) {\n    console.error('Advanced search error:', error);\n  }\n}\n\nasync function clearFilters() {\n  await ensureLibraryViewForResults();\n  const artist = document.getElementById('filterArtist');\n  const album = document.getElementById('filterAlbum');\n  const genre = document.getElementById('filterGenre');\n  const year = document.getElementById('filterYear');\n\n  if (artist) artist.value = '';\n  if (album) album.value = '';\n  if (genre) genre.value = '';\n  if (year) year.value = '';\n  if (searchInput) searchInput.value = '';\n\n  const songs = await fetchAllSongs();\n  setCurrentSongs(songs);\n  renderSongs(songs, playSongFromList);\n}\n\nasync function runDiscoveryNotPlayedRecently() {\n  await ensureLibraryViewForResults();\n  const songs = await fetchAllSongs();\n  const sorted = [...songs].sort((a, b) => {\n    const aTime = a.lastPlayed ? Date.parse(a.lastPlayed) : 0;\n    const bTime = b.lastPlayed ? Date.parse(b.lastPlayed) : 0;\n    if (!a.lastPlayed && b.lastPlayed) return -1;\n    if (a.lastPlayed && !b.lastPlayed) return 1;\n    return aTime - bTime;\n  });\n  const pick = sorted.slice(0, 300);\n  setCurrentSongs(pick);\n  renderSongs(pick, playSongFromList);\n}\n\nasync function runDiscoveryLowPlayCount() {\n  await ensureLibraryViewForResults();\n  const songs = await fetchAllSongs();\n  const sorted = [...songs].sort((a, b) => {\n    const aCount = Number.isFinite(Number(a.playCount)) ? Number(a.playCount) : 0;\n    const bCount = Number.isFinite(Number(b.playCount)) ? Number(b.playCount) : 0;\n    if (aCount !== bCount) return aCount - bCount;\n    const aTime = a.lastPlayed ? Date.parse(a.lastPlayed) : 0;\n    const bTime = b.lastPlayed ? Date.parse(b.lastPlayed) : 0;\n    return aTime - bTime;\n  });\n  const pick = sorted.slice(0, 300);\n  setCurrentSongs(pick);\n  renderSongs(pick, playSongFromList);\n}\n\n// ============================================\n// Search Autocomplete Functions\n// ============================================\n\nfunction createSuggestionsDropdown() {\n  if (suggestionsDropdown) return;\n  \n  suggestionsDropdown = document.createElement('div');\n  suggestionsDropdown.className = 'search-suggestions';\n  suggestionsDropdown.style.display = 'none';\n  \n  // Insert after search input's parent\n  const searchBar = searchInput.closest('.search-bar');\n  if (searchBar) {\n    searchBar.style.position = 'relative';\n    searchBar.appendChild(suggestionsDropdown);\n  }\n  \n  // Close on outside click\n  document.addEventListener('click', (e) => {\n    if (!searchInput.contains(e.target) && !suggestionsDropdown.contains(e.target)) {\n      hideSuggestions();\n    }\n  });\n}\n\nasync function handleSearchInput(e) {\n  const query = searchInput.value.trim();\n  \n  if (query.length < 2) {\n    hideSuggestions();\n    currentSuggestions = [];\n    // Still perform search to show all results when input is cleared\n    if (query.length === 0) {\n      void performSearch();\n    }\n    return;\n  }\n  \n  try {\n    const suggestions = await getSearchSuggestions(query, 5);\n    currentSuggestions = flattenSuggestions(suggestions);\n    \n    if (currentSuggestions.length > 0) {\n      renderSuggestions(suggestions);\n      showSuggestions();\n    } else {\n      hideSuggestions();\n    }\n  } catch (error) {\n    console.error('Error getting suggestions:', error);\n    hideSuggestions();\n  }\n}\n\nfunction flattenSuggestions(suggestions) {\n  const flat = [];\n  \n  if (suggestions.artists?.length) {\n    suggestions.artists.forEach(s => flat.push({ ...s, category: 'artist' }));\n  }\n  if (suggestions.albums?.length) {\n    suggestions.albums.forEach(s => flat.push({ ...s, category: 'album' }));\n  }\n  if (suggestions.songs?.length) {\n    suggestions.songs.forEach(s => flat.push({ ...s, category: 'song' }));\n  }\n  if (suggestions.genres?.length) {\n    suggestions.genres.forEach(s => flat.push({ ...s, category: 'genre' }));\n  }\n  \n  return flat;\n}\n\nfunction renderSuggestions(suggestions) {\n  if (!suggestionsDropdown) return;\n  \n  let html = '';\n  selectedSuggestionIndex = -1;\n  \n  const categoryIcons = {\n    artists: `<svg class=\"suggestion-icon\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" width=\"16\" height=\"16\"><path d=\"M12 2a10 10 0 0 1 10 10 10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2z\"/><path d=\"M9 9h.01M15 9h.01M9 15s1.5 2 3 2 3-2 3-2\"/></svg>`,\n    albums: `<svg class=\"suggestion-icon\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" width=\"16\" height=\"16\"><circle cx=\"12\" cy=\"12\" r=\"10\"/><circle cx=\"12\" cy=\"12\" r=\"3\"/></svg>`,\n    songs: `<svg class=\"suggestion-icon\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" width=\"16\" height=\"16\"><path d=\"M9 18V5l12-2v13\"/><circle cx=\"6\" cy=\"18\" r=\"3\"/><circle cx=\"18\" cy=\"16\" r=\"3\"/></svg>`,\n    genres: `<svg class=\"suggestion-icon\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" width=\"16\" height=\"16\"><path d=\"M12 2L2 7l10 5 10-5-10-5z\"/><path d=\"M2 17l10 5 10-5M2 12l10 5 10-5\"/></svg>`\n  };\n  \n  let globalIndex = 0;\n  \n  for (const [category, items] of Object.entries(suggestions)) {\n    if (!items || items.length === 0) continue;\n    \n    const categoryLabel = category.charAt(0).toUpperCase() + category.slice(1);\n    html += `<div class=\"suggestion-category\">\n      <div class=\"suggestion-category-header\">${categoryIcons[category] || ''} ${categoryLabel}</div>`;\n    \n    for (const item of items) {\n      const subtitle = item.artist ? `<span class=\"suggestion-subtitle\">${escapeHtml(item.artist)}</span>` : '';\n      html += `<div class=\"suggestion-item\" data-index=\"${globalIndex}\" data-type=\"${item.type}\" data-value=\"${escapeHtml(item.value)}\" ${item.id ? `data-id=\"${item.id}\"` : ''} ${item.artist ? `data-artist=\"${escapeHtml(item.artist)}\"` : ''}>\n        <span class=\"suggestion-text\">${escapeHtml(item.value)}</span>\n        ${subtitle}\n      </div>`;\n      globalIndex++;\n    }\n    \n    html += '</div>';\n  }\n  \n  suggestionsDropdown.innerHTML = html;\n  \n  // Add click handlers\n  suggestionsDropdown.querySelectorAll('.suggestion-item').forEach(item => {\n    item.addEventListener('click', () => handleSuggestionClick(item));\n    item.addEventListener('mouseenter', () => {\n      selectedSuggestionIndex = parseInt(item.dataset.index, 10);\n      updateSelectedSuggestion();\n    });\n  });\n}\n\nfunction escapeHtml(text) {\n  const div = document.createElement('div');\n  div.textContent = text || '';\n  return div.innerHTML;\n}\n\nfunction showSuggestions() {\n  if (suggestionsDropdown) {\n    suggestionsDropdown.style.display = 'block';\n  }\n}\n\nfunction hideSuggestions() {\n  if (suggestionsDropdown) {\n    suggestionsDropdown.style.display = 'none';\n  }\n  selectedSuggestionIndex = -1;\n}\n\nfunction handleSearchKeydown(e) {\n  if (!suggestionsDropdown || suggestionsDropdown.style.display === 'none') return;\n  \n  const items = suggestionsDropdown.querySelectorAll('.suggestion-item');\n  if (items.length === 0) return;\n  \n  switch (e.key) {\n    case 'ArrowDown':\n      e.preventDefault();\n      selectedSuggestionIndex = Math.min(selectedSuggestionIndex + 1, items.length - 1);\n      updateSelectedSuggestion();\n      break;\n    case 'ArrowUp':\n      e.preventDefault();\n      selectedSuggestionIndex = Math.max(selectedSuggestionIndex - 1, -1);\n      updateSelectedSuggestion();\n      break;\n    case 'Enter':\n      if (selectedSuggestionIndex >= 0 && items[selectedSuggestionIndex]) {\n        e.preventDefault();\n        handleSuggestionClick(items[selectedSuggestionIndex]);\n      }\n      break;\n    case 'Escape':\n      hideSuggestions();\n      break;\n  }\n}\n\nfunction updateSelectedSuggestion() {\n  const items = suggestionsDropdown?.querySelectorAll('.suggestion-item');\n  if (!items) return;\n  \n  items.forEach((item, index) => {\n    item.classList.toggle('selected', index === selectedSuggestionIndex);\n  });\n  \n  // Scroll into view\n  if (selectedSuggestionIndex >= 0 && items[selectedSuggestionIndex]) {\n    items[selectedSuggestionIndex].scrollIntoView({ block: 'nearest' });\n  }\n}\n\nasync function handleSuggestionClick(item) {\n  const type = item.dataset.type;\n  const value = item.dataset.value;\n  const artist = item.dataset.artist;\n  const id = item.dataset.id;\n  \n  hideSuggestions();\n  \n  switch (type) {\n    case 'artist':\n      searchInput.value = '';\n      document.getElementById('filterArtist')?.setAttribute('value', value);\n      await searchByArtist(value);\n      break;\n    case 'album':\n      searchInput.value = '';\n      await searchByAlbum(value, artist);\n      break;\n    case 'song':\n      searchInput.value = value;\n      await performSearch();\n      break;\n    case 'genre':\n      searchInput.value = '';\n      await searchByGenre(value);\n      break;\n    default:\n      searchInput.value = value;\n      await performSearch();\n  }\n}\n\nasync function searchByArtist(artist) {\n  await ensureLibraryViewForResults();\n  try {\n    const songs = await advancedSearch({ artist });\n    setCurrentSongs(songs);\n    renderSongs(songs, playSongFromList);\n  } catch (error) {\n    console.error('Error searching by artist:', error);\n  }\n}\n\nasync function searchByAlbum(album, artist) {\n  await ensureLibraryViewForResults();\n  try {\n    const filters = { album };\n    if (artist) filters.artist = artist;\n    const songs = await advancedSearch(filters);\n    setCurrentSongs(songs);\n    renderSongs(songs, playSongFromList);\n  } catch (error) {\n    console.error('Error searching by album:', error);\n  }\n}\n\nasync function searchByGenre(genre) {\n  await ensureLibraryViewForResults();\n  try {\n    const songs = await advancedSearch({ genre });\n    setCurrentSongs(songs);\n    renderSongs(songs, playSongFromList);\n  } catch (error) {\n    console.error('Error searching by genre:', error);\n  }\n}\n\nasync function advancedSearch(filters) {\n  return await AdvancedSearchAPI(filters);\n}\n",
    "import { listArtists } from '../API.js';\nimport { renderArtists } from '../ui.js';\nimport { switchView } from './views.js';\nimport { performSearch } from './search.js';\n\nconst searchInput = document.getElementById('searchInput');\n\nexport async function loadArtists() {\n  try {\n    const artists = await listArtists();\n    renderArtists(artists, async (artistName) => {\n      if (searchInput) searchInput.value = artistName;\n      await switchView('library');\n      await performSearch();\n    });\n  } catch (error) {\n    console.error('Error loading artists:', error);\n  }\n}\n",
    "import { formatDuration } from '../utils.js';\nimport { fetchAllSongs, getStats, songCoverUrl } from '../API.js';\nimport { setCurrentSongs } from '../state.js';\nimport { renderStats } from '../ui.js';\nimport { playSongFromList } from './library.js';\n\nlet latestStats = null;\n\nexport async function loadStats() {\n  try {\n    latestStats = await getStats();\n    renderStats(latestStats);\n\n    const layout = document.getElementById('statsLayout');\n    if (!layout) return;\n\n    const activateTile = async (tile) => {\n      try {\n        const stats = latestStats;\n        if (!stats) return;\n\n        const action = tile.dataset.statsAction;\n        const target = tile.dataset.statsTarget;\n        const modalKey = tile.dataset.statsModal;\n\n        if (action === 'navigate' && target) {\n          window.location.hash = `#/${target}`;\n          return;\n        }\n\n        if (action === 'modal' && modalKey) {\n          if (modalKey === 'mostPlayed') {\n            const items = (stats.mostPlayed || []).map(song => ({\n              songId: song.id,\n              title: song.title || 'Unknown',\n              subtitle: song.artist || 'Unknown Artist',\n              rightText: `${song.playCount || 0} plays`\n            }));\n            await openStatsSongListModal('Most Played Songs', items);\n            return;\n          }\n\n          if (modalKey === 'recentlyPlayed') {\n            const items = (stats.recentlyPlayed || []).map(play => ({\n              songId: play.songId,\n              title: play.title || 'Unknown',\n              subtitle: play.artist || 'Unknown Artist',\n              rightText: play.playedAt ? new Date(play.playedAt).toLocaleString() : ''\n            }));\n            await openStatsSongListModal('Recently Played', items);\n            return;\n          }\n\n          if (modalKey === 'genres') {\n            if (Array.isArray(stats.genreReport) && stats.genreReport.length) {\n              const items = stats.genreReport.map(g => ({\n                title: g.genre,\n                subtitle: `${g.songs} songs • ${g.totalPlays} plays • ${formatDurationLong(g.listeningTime || 0)}`\n              }));\n              openStatsListModal('Genre Report', items);\n              return;\n            }\n\n            const songs = await fetchAllSongs();\n            const genreCounts = new Map();\n            (songs || []).forEach(s => {\n              if (!s.genre) return;\n              genreCounts.set(s.genre, (genreCounts.get(s.genre) || 0) + 1);\n            });\n            const genres = Array.from(genreCounts.entries()).sort((a, b) => {\n              if (b[1] !== a[1]) return b[1] - a[1];\n              return String(a[0]).localeCompare(String(b[0]));\n            });\n            const items = genres.map(([g, count]) => ({ title: g, subtitle: `${count} songs` }));\n            openStatsListModal('Genres', items);\n            return;\n          }\n\n          if (modalKey === 'summary') {\n            const showAlbumReport = () => {\n              if (Array.isArray(stats.albumReport) && stats.albumReport.length) {\n                const items = stats.albumReport.map(a => ({\n                  title: `${a.album} — ${a.artist}`,\n                  subtitle: `${a.tracks} tracks • ${a.totalPlays} plays • ${formatDurationLong(a.listeningTime || 0)}`\n                }));\n                openStatsListModal('Album Report', items);\n                return;\n              }\n              openStatsListModal('Album Report', []);\n            };\n\n            const items = [\n              { title: 'Total Songs', subtitle: String(stats.totalSongs || 0) },\n              { title: 'Artists', subtitle: String(stats.uniqueArtists || 0) },\n              { title: 'Albums', subtitle: String(stats.uniqueAlbums || 0) },\n              { title: 'Genres', subtitle: String(stats.uniqueGenres || 0) },\n              { title: 'Total Playlists', subtitle: String(stats.totalPlaylists || 0) },\n              { title: 'Total Plays', subtitle: String(stats.totalPlays || 0) },\n              { title: 'Library Duration', subtitle: formatDuration(stats.totalDuration || 0) },\n              { title: 'Total Listening Time', subtitle: formatDurationLong(stats.totalListeningTime || 0) },\n              { title: 'Album Report', subtitle: 'Open top albums', onClick: showAlbumReport },\n              { title: 'Export Stats (CSV)', subtitle: 'Download song-level stats', onClick: () => { void exportStatsCsv(); } }\n            ];\n            openStatsListModal('Totals', items);\n            return;\n          }\n        }\n      } catch (err) {\n        console.error('Error activating stats tile:', err);\n      }\n    };\n\n    if (!layout.dataset.statsBound) {\n      layout.dataset.statsBound = '1';\n      layout.addEventListener('click', (e) => {\n        const tile = e.target?.closest?.('.stat-tile');\n        if (!tile) return;\n        void activateTile(tile);\n      });\n      layout.addEventListener('keydown', (e) => {\n        if (e.key !== 'Enter' && e.key !== ' ') return;\n        const tile = e.target?.closest?.('.stat-tile');\n        if (!tile) return;\n        e.preventDefault();\n        void activateTile(tile);\n      });\n    }\n  } catch (error) {\n    console.error('Error loading stats:', error);\n  }\n}\n\nfunction escapeHtml(text) {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\nexport function openStatsListModal(title, items) {\n  const modal = document.getElementById('statsListModal');\n  const titleEl = document.getElementById('statsListModalTitle');\n  const bodyEl = document.getElementById('statsListModalBody');\n  if (!modal || !titleEl || !bodyEl) return;\n\n  titleEl.textContent = title || 'Statistics';\n  bodyEl.innerHTML = '';\n\n  if (!items || items.length === 0) {\n    bodyEl.innerHTML = `<div class=\"stats-list-item\"><div class=\"stats-list-item-title\">No items</div><div class=\"stats-list-item-subtitle\">Nothing to show yet</div></div>`;\n    modal.style.display = 'flex';\n    return;\n  }\n\n  items.forEach((item) => {\n    const el = document.createElement('div');\n    el.className = 'stats-list-item';\n    const primary = typeof item === 'string' ? item : (item?.title || item?.primary || '');\n    const secondary = typeof item === 'string' ? '' : (item?.subtitle || item?.secondary || '');\n\n    if (typeof item === 'object' && typeof item?.onClick === 'function') {\n      el.classList.add('is-clickable');\n      el.tabIndex = 0;\n      el.setAttribute('role', 'button');\n      el.addEventListener('click', () => item.onClick());\n      el.addEventListener('keydown', (e) => {\n        if (e.key === 'Enter' || e.key === ' ') {\n          e.preventDefault();\n          item.onClick();\n        }\n      });\n    }\n\n    el.innerHTML = `\n      <div class=\"stats-list-item-title\">${escapeHtml(String(primary))}</div>\n      ${secondary ? `<div class=\"stats-list-item-subtitle\">${escapeHtml(String(secondary))}</div>` : ''}\n    `;\n    bodyEl.appendChild(el);\n  });\n\n  modal.style.display = 'flex';\n}\n\nexport async function openStatsSongListModal(title, songItems) {\n  const modal = document.getElementById('statsListModal');\n  const titleEl = document.getElementById('statsListModalTitle');\n  const bodyEl = document.getElementById('statsListModalBody');\n  if (!modal || !titleEl || !bodyEl) return;\n\n  titleEl.textContent = title || 'Songs';\n  bodyEl.innerHTML = '';\n\n  if (!songItems || songItems.length === 0) {\n    bodyEl.innerHTML = `<div class=\"stats-list-item\"><div class=\"stats-list-item-title\">No songs</div><div class=\"stats-list-item-subtitle\">Nothing to show yet</div></div>`;\n    modal.style.display = 'flex';\n    return;\n  }\n\n  songItems.forEach((item) => {\n    const row = document.createElement('div');\n    row.className = 'song-list-item';\n    row.style.cursor = 'pointer';\n    row.dataset.songId = item.songId;\n    row.innerHTML = `\n      <img src=\"${songCoverUrl(item.songId)}\" alt=\"Cover\" class=\"song-list-cover\" onerror=\"this.style.display='none'\">\n      <div style=\"flex: 1; min-width: 0;\">\n        <div>${escapeHtml(item.title || 'Unknown')}</div>\n        <div style=\"font-size: 12px; color: var(--text-secondary);\">${escapeHtml(item.subtitle || '')}</div>\n      </div>\n      ${item.rightText ? `<div style=\"color: var(--text-secondary); font-size: 12px;\">${escapeHtml(item.rightText)}</div>` : ''}\n    `;\n    row.addEventListener('click', async () => {\n      try {\n        const songId = row.dataset.songId;\n        if (!songId) return;\n        const songs = await fetchAllSongs();\n        const index = songs.findIndex(s => s.id === songId);\n        if (index >= 0) {\n          setCurrentSongs(songs);\n          playSongFromList(index);\n          modal.style.display = 'none';\n        }\n      } catch (error) {\n        console.error('Error playing song from stats modal:', error);\n      }\n    });\n    bodyEl.appendChild(row);\n  });\n\n  modal.style.display = 'flex';\n}\n\nfunction downloadTextFile(filename, content, mimeType = 'text/plain') {\n  const blob = new Blob([content], { type: mimeType });\n  const url = URL.createObjectURL(blob);\n  const a = document.createElement('a');\n  a.href = url;\n  a.download = filename;\n  document.body.appendChild(a);\n  a.click();\n  a.remove();\n  URL.revokeObjectURL(url);\n}\n\nfunction toCsvValue(value) {\n  const text = String(value ?? '');\n  if (/[\\n\\r\",]/.test(text)) return `\"${text.replace(/\"/g, '\"\"')}\"`;\n  return text;\n}\n\nexport async function exportStatsCsv() {\n  const songs = await fetchAllSongs();\n  const header = ['id','title','artist','album','genre','year','durationSeconds','playCount','lastPlayed','listeningTimeSeconds'];\n  const lines = [header.join(',')];\n\n  (songs || []).forEach(song => {\n    const playCount = Number.isFinite(Number(song.playCount)) ? Number(song.playCount) : 0;\n    const duration = Number.isFinite(Number(song.duration)) ? Number(song.duration) : 0;\n    const listeningTime = playCount * duration;\n    const row = [\n      song.id,\n      song.title || '',\n      song.artist || '',\n      song.album || '',\n      song.genre || '',\n      song.year || '',\n      duration,\n      playCount,\n      song.lastPlayed || '',\n      listeningTime\n    ].map(toCsvValue);\n    lines.push(row.join(','));\n  });\n\n  const filename = `player0-stats-${new Date().toISOString().slice(0,10)}.csv`;\n  downloadTextFile(filename, lines.join('\\n'), 'text/csv');\n}\n\nfunction formatDurationLong(totalSeconds) {\n  const seconds = Math.max(0, Math.floor(Number(totalSeconds) || 0));\n  const h = Math.floor(seconds / 3600);\n  const m = Math.floor((seconds % 3600) / 60);\n  const s = seconds % 60;\n  if (h > 0) return `${h}:${String(m).padStart(2, '0')}:${String(s).padStart(2, '0')}`;\n  return `${m}:${String(s).padStart(2, '0')}`;\n}\n",
    "import { clearCache, createPlaylist, fetchAllSongs, listPlaylists } from '../API.js';\n\nfunction downloadBlob(filename, blob) {\n  const url = URL.createObjectURL(blob);\n  const a = document.createElement('a');\n  a.href = url;\n  a.download = filename;\n  document.body.appendChild(a);\n  a.click();\n  a.remove();\n  URL.revokeObjectURL(url);\n}\n\nexport async function exportPlaylistsAsJson() {\n  const playlists = await listPlaylists();\n\n  const settings = {};\n  try {\n    for (let i = 0; i < localStorage.length; i++) {\n      const key = localStorage.key(i);\n      if (!key || !key.startsWith('player0.')) continue;\n      settings[key] = localStorage.getItem(key);\n    }\n  } catch {\n    // ignore (storage may be unavailable)\n  }\n\n  const payload = {\n    version: 1,\n    exportedAt: new Date().toISOString(),\n    playlists: (playlists || []).map(p => ({\n      name: p.name,\n      description: p.description || '',\n      songIds: Array.isArray(p.songIds) ? p.songIds : []\n    })),\n    settings\n  };\n\n  const blob = new Blob([JSON.stringify(payload, null, 2)], { type: 'application/json' });\n  downloadBlob(`player0-playlists-${new Date().toISOString().slice(0, 10)}.json`, blob);\n}\n\nfunction normalizeImportedPayload(data) {\n  if (!data) return [];\n\n  // Accept either {playlists:[...]} or raw array\n  const list = Array.isArray(data) ? data : Array.isArray(data.playlists) ? data.playlists : [];\n\n  return list\n    .map(p => ({\n      name: String(p?.name || '').trim(),\n      description: String(p?.description || '').trim(),\n      songIds: Array.isArray(p?.songIds) ? p.songIds.filter(Boolean) : []\n    }))\n    .filter(p => p.name.length > 0);\n}\n\nexport async function importPlaylistsFromJsonFile(file) {\n  if (!file) return;\n\n  const text = await file.text();\n  let parsed;\n  try {\n    parsed = JSON.parse(text);\n  } catch {\n    throw new Error('Invalid JSON file');\n  }\n\n  // If present, import settings (localStorage keys under player0.*)\n  try {\n    const settings = parsed && typeof parsed === 'object' ? parsed.settings : null;\n    if (settings && typeof settings === 'object') {\n      for (const [key, value] of Object.entries(settings)) {\n        if (typeof key !== 'string' || !key.startsWith('player0.')) continue;\n        localStorage.setItem(key, String(value ?? ''));\n      }\n    }\n  } catch {\n    // ignore\n  }\n\n  const toImport = normalizeImportedPayload(parsed);\n  if (toImport.length === 0) {\n    throw new Error('No playlists found in file');\n  }\n\n  // Create sequentially to keep it simple and avoid spamming the server.\n  for (const p of toImport) {\n    await createPlaylist(p.name, p.description, p.songIds);\n  }\n\n  clearCache();\n}\n\nfunction safeFileBaseName(name) {\n  const base = String(name || 'playlist')\n    .replace(/\\.[^/.]+$/, '')\n    .trim()\n    .slice(0, 80);\n  return base.length ? base : 'playlist';\n}\n\nfunction normalizePathLike(value) {\n  let v = String(value || '').trim();\n  if (!v) return '';\n\n  // strip surrounding quotes\n  v = v.replace(/^['\"]|['\"]$/g, '');\n\n  // file:// URI support\n  if (v.startsWith('file://')) {\n    v = v.replace(/^file:\\/\\//, '');\n    try {\n      v = decodeURIComponent(v);\n    } catch {\n      // ignore\n    }\n  }\n\n  // normalize separators\n  v = v.replace(/\\\\/g, '/');\n  return v;\n}\n\nfunction parseM3u(text) {\n  const entries = [];\n  for (const rawLine of String(text || '').split(/\\r?\\n/)) {\n    const line = rawLine.trim();\n    if (!line) continue;\n    if (line.startsWith('#')) continue;\n    entries.push(line);\n  }\n  return entries;\n}\n\nfunction parsePls(text) {\n  const filesByIndex = new Map();\n  for (const rawLine of String(text || '').split(/\\r?\\n/)) {\n    const line = rawLine.trim();\n    if (!line) continue;\n    if (line.startsWith(';')) continue;\n    if (line.startsWith('[') && line.endsWith(']')) continue;\n\n    const eq = line.indexOf('=');\n    if (eq === -1) continue;\n    const key = line.slice(0, eq).trim();\n    const value = line.slice(eq + 1).trim();\n\n    const m = /^File(\\d+)$/i.exec(key);\n    if (!m) continue;\n    const idx = Number(m[1]);\n    if (!Number.isFinite(idx) || idx <= 0) continue;\n    filesByIndex.set(idx, value);\n  }\n\n  const maxIndex = Math.max(0, ...filesByIndex.keys());\n  const entries = [];\n  for (let i = 1; i <= maxIndex; i++) {\n    const v = filesByIndex.get(i);\n    if (v) entries.push(v);\n  }\n  return entries;\n}\n\nfunction formatExtinf(song) {\n  const seconds = Number.isFinite(song?.duration) ? Math.round(song.duration) : -1;\n  const artist = song?.artist ? String(song.artist) : '';\n  const title = song?.title ? String(song.title) : '';\n  const label = [artist, title].filter(Boolean).join(' - ') || title || 'Unknown';\n  return `#EXTINF:${seconds},${label}`;\n}\n\nexport function exportPlaylistAsM3U(playlistName, songs) {\n  const safeName = safeFileBaseName(playlistName);\n\n  const lines = ['#EXTM3U'];\n  for (const song of songs || []) {\n    if (!song?.filePath) continue;\n    lines.push(formatExtinf(song));\n    lines.push(String(song.filePath));\n  }\n\n  const blob = new Blob([lines.join('\\n') + '\\n'], { type: 'audio/x-mpegurl' });\n  downloadBlob(`player0-${safeName}.m3u8`, blob);\n}\n\nexport function exportPlaylistAsPLS(playlistName, songs) {\n  const safeName = safeFileBaseName(playlistName);\n\n  const validSongs = (songs || []).filter(s => s?.filePath);\n  const lines = ['[playlist]'];\n\n  validSongs.forEach((song, index) => {\n    const n = index + 1;\n    const seconds = Number.isFinite(song?.duration) ? Math.round(song.duration) : -1;\n    const artist = song?.artist ? String(song.artist) : '';\n    const title = song?.title ? String(song.title) : '';\n    const label = [artist, title].filter(Boolean).join(' - ') || title || 'Unknown';\n    lines.push(`File${n}=${String(song.filePath)}`);\n    lines.push(`Title${n}=${label}`);\n    lines.push(`Length${n}=${seconds}`);\n  });\n\n  lines.push(`NumberOfEntries=${validSongs.length}`);\n  lines.push('Version=2');\n\n  const blob = new Blob([lines.join('\\n') + '\\n'], { type: 'audio/x-scpls' });\n  downloadBlob(`player0-${safeName}.pls`, blob);\n}\n\nexport async function importPlaylistFromM3uOrPlsFile(file) {\n  if (!file) return;\n\n  const filename = String(file.name || '').toLowerCase();\n  const text = await file.text();\n\n  let entries;\n  if (filename.endsWith('.pls')) {\n    entries = parsePls(text);\n  } else if (filename.endsWith('.m3u') || filename.endsWith('.m3u8')) {\n    entries = parseM3u(text);\n  } else {\n    throw new Error('Unsupported playlist file type (use .m3u/.m3u8/.pls)');\n  }\n\n  if (!entries || entries.length === 0) {\n    throw new Error('No entries found in playlist file');\n  }\n\n  const allSongs = await fetchAllSongs();\n  const byPath = new Map();\n  const byBase = new Map();\n\n  for (const song of allSongs || []) {\n    const fp = song?.filePath;\n    if (!fp) continue;\n    const norm = normalizePathLike(fp);\n    byPath.set(norm, song.id);\n\n    const base = norm.split('/').pop()?.toLowerCase();\n    if (base && !byBase.has(base)) byBase.set(base, song.id);\n  }\n\n  const songIds = [];\n  let missingCount = 0;\n  for (const entry of entries) {\n    const norm = normalizePathLike(entry);\n    if (!norm) continue;\n\n    const direct = byPath.get(norm);\n    if (direct) {\n      songIds.push(direct);\n      continue;\n    }\n\n    const base = norm.split('/').pop()?.toLowerCase();\n    const viaBase = base ? byBase.get(base) : null;\n    if (viaBase) {\n      songIds.push(viaBase);\n    } else {\n      missingCount++;\n    }\n  }\n\n  const playlistName = safeFileBaseName(file.name);\n  const created = await createPlaylist(playlistName, '', songIds);\n  clearCache();\n\n  return {\n    playlistId: created?.id,\n    playlistName: created?.name || playlistName,\n    importedCount: songIds.length,\n    missingCount\n  };\n}\n",
    "import { exportStatsCsv } from './stats.js';\nimport { fetchAllSongs, getPlaylist, listPlaylists } from '../API.js';\nimport {\n  exportPlaylistsAsJson,\n  exportPlaylistAsM3U,\n  exportPlaylistAsPLS,\n  importPlaylistsFromJsonFile,\n  importPlaylistFromM3uOrPlsFile\n} from './playlistImportExport.js';\n\nexport function setupSettingsView() {\n  const exportButton = document.getElementById('exportStatsCsvButton');\n  if (exportButton) {\n    exportButton.onclick = () => {\n      void exportStatsCsv();\n    };\n  }\n\n  const exportPlaylistsBtn = document.getElementById('settingsExportPlaylistsJson');\n  if (exportPlaylistsBtn) {\n    exportPlaylistsBtn.onclick = () => {\n      void exportPlaylistsAsJson().catch(err => {\n        console.error('Export playlists failed:', err);\n        alert('Export failed: ' + (err?.message || err));\n      });\n    };\n  }\n\n  const importPlaylistsBtn = document.getElementById('settingsImportPlaylistsJson');\n  const jsonInput = document.getElementById('settingsPlaylistsJsonFile');\n  if (importPlaylistsBtn && jsonInput) {\n    importPlaylistsBtn.onclick = () => jsonInput.click();\n    jsonInput.onchange = () => {\n      const file = jsonInput.files?.[0];\n      if (!file) return;\n      void (async () => {\n        try {\n          await importPlaylistsFromJsonFile(file);\n          alert('Import complete');\n        } catch (err) {\n          console.error('Import playlists failed:', err);\n          alert('Import failed: ' + (err?.message || err));\n        } finally {\n          jsonInput.value = '';\n        }\n      })();\n    };\n  }\n\n  const importM3uPlsBtn = document.getElementById('settingsImportPlaylistsM3uPls');\n  const m3uPlsInput = document.getElementById('settingsPlaylistsM3uPlsFile');\n  if (importM3uPlsBtn && m3uPlsInput) {\n    importM3uPlsBtn.onclick = () => m3uPlsInput.click();\n    m3uPlsInput.onchange = () => {\n      const file = m3uPlsInput.files?.[0];\n      if (!file) return;\n      void (async () => {\n        try {\n          const result = await importPlaylistFromM3uOrPlsFile(file);\n          if (result) {\n            alert(\n              `Imported playlist \"${result.playlistName}\". Added ${result.importedCount} tracks` +\n                (result.missingCount ? `, skipped ${result.missingCount} missing.` : '.')\n            );\n          } else {\n            alert('Import complete');\n          }\n          void refreshPlaylistExportSelect();\n        } catch (err) {\n          console.error('Import M3U/PLS failed:', err);\n          alert('Import failed: ' + (err?.message || err));\n        } finally {\n          m3uPlsInput.value = '';\n        }\n      })();\n    };\n  }\n\n  const playlistSelect = document.getElementById('settingsPlaylistExportSelect');\n  const exportM3uBtn = document.getElementById('settingsExportPlaylistM3U');\n  const exportPlsBtn = document.getElementById('settingsExportPlaylistPLS');\n  if (playlistSelect && exportM3uBtn && exportPlsBtn) {\n    exportM3uBtn.onclick = () => void exportSelectedPlaylist('m3u');\n    exportPlsBtn.onclick = () => void exportSelectedPlaylist('pls');\n    void refreshPlaylistExportSelect();\n  }\n\n  async function refreshPlaylistExportSelect() {\n    const select = document.getElementById('settingsPlaylistExportSelect');\n    if (!select) return;\n\n    try {\n      const playlists = await listPlaylists();\n      const previous = select.value;\n      select.innerHTML = '';\n\n      const list = Array.isArray(playlists) ? playlists : [];\n      if (list.length === 0) {\n        const opt = document.createElement('option');\n        opt.value = '';\n        opt.textContent = 'No playlists available';\n        select.appendChild(opt);\n        select.disabled = true;\n        return;\n      }\n\n      select.disabled = false;\n      for (const p of list) {\n        const opt = document.createElement('option');\n        opt.value = p.id;\n        opt.textContent = p.name;\n        select.appendChild(opt);\n      }\n\n      if (previous && Array.from(select.options).some(o => o.value === previous)) {\n        select.value = previous;\n      }\n    } catch (err) {\n      console.error('Failed to load playlists for export:', err);\n    }\n  }\n\n  async function exportSelectedPlaylist(format) {\n    const select = document.getElementById('settingsPlaylistExportSelect');\n    if (!select) return;\n    const playlistId = select.value;\n    if (!playlistId) {\n      alert('Select a playlist to export');\n      return;\n    }\n\n    try {\n      const playlist = await getPlaylist(playlistId);\n      const allSongs = await fetchAllSongs();\n      const playlistSongs = (playlist.songIds || [])\n        .map(id => (allSongs || []).find(s => s.id === id))\n        .filter(Boolean);\n\n      if (format === 'm3u') {\n        exportPlaylistAsM3U(playlist.name, playlistSongs);\n      } else {\n        exportPlaylistAsPLS(playlist.name, playlistSongs);\n      }\n    } catch (err) {\n      console.error('Export playlist failed:', err);\n      alert('Export failed: ' + (err?.message || err));\n    }\n  }\n}\n",
    "import { loadSongs } from './library.js';\nimport { loadAlbums } from './albums.js';\nimport { loadArtists } from './artists.js';\nimport { loadPlaylists } from './playlists.js';\nimport { loadStats } from './stats.js';\nimport { setupSettingsView } from './settings.js';\n\nexport async function switchView(viewName, updateUrl = true) {\n  const container = document.getElementById('viewContainer');\n  if (!container) return;\n\n  // Mobile: hide the search bar when navigating between views.\n  if (window.matchMedia('(max-width: 700px)').matches) {\n    document.body.classList.remove('mobile-search-open');\n    document.getElementById('searchInput')?.blur();\n\n    const advanced = document.getElementById('advancedSearch');\n    if (advanced) advanced.style.display = 'none';\n    document.getElementById('advancedSearchToggle')?.classList.remove('active');\n  }\n\n  const viewMap = {\n    library: 'library.html',\n    albums: 'albums.html',\n    artists: 'artists.html',\n    playlists: 'playlists.html',\n    playlistDetailView: 'playlist-detail.html',\n    albumDetailView: 'album-detail.html',\n    stats: 'stats.html',\n    settings: 'settings.html'\n  };\n\n  const htmlFile = viewMap[viewName] || viewMap[viewName.replace('View', '')];\n  if (!htmlFile) return;\n\n  try {\n    const response = await fetch(`/views/${htmlFile}`);\n    const html = await response.text();\n    container.innerHTML = html;\n\n    container.style.animation = 'fadeIn 0.3s ease-out';\n\n    if (updateUrl) {\n      const route = viewName.replace('View', '');\n      window.location.hash = `#/${route}`;\n    }\n\n    document.querySelectorAll('.nav-item').forEach(item => {\n      item.classList.remove('active');\n      if (item.dataset.view === viewName || item.dataset.view === viewName.replace('View', '')) {\n        item.classList.add('active');\n      }\n    });\n\n    switch (viewName) {\n      case 'library':\n        void loadSongs();\n        break;\n      case 'albums':\n        void loadAlbums();\n        break;\n      case 'artists':\n        void loadArtists();\n        break;\n      case 'playlists':\n        void loadPlaylists();\n        break;\n      case 'stats':\n        void loadStats();\n        break;\n      case 'settings':\n        setupSettingsView();\n        break;\n    }\n  } catch (error) {\n    console.error('Error loading view:', error);\n    container.innerHTML = '<div class=\"error\">Failed to load view</div>';\n  }\n}\n",
    "import { switchView } from './viewSwitcher.js';\nimport { loadAlbumDetail } from './albums.js';\nimport { loadPlaylistDetail } from './playlists.js';\n\nexport { switchView };\n\nexport async function initRouter() {\n  const handleRoute = async () => {\n    const hash = window.location.hash.slice(2); // Remove #/\n    const parts = hash.split('/');\n    const view = parts[0];\n\n    if (view && view !== '') {\n      if (view === 'playlist' && parts[1]) {\n        await loadPlaylistDetail(parts[1]);\n      } else if (view === 'album' && parts[1] && parts[2]) {\n        await loadAlbumDetail(decodeURIComponent(parts[1]), decodeURIComponent(parts[2]));\n      } else {\n        await switchView(view, false);\n      }\n    } else {\n      await switchView('library', false);\n    }\n  };\n\n  window.addEventListener('hashchange', () => {\n    void handleRoute();\n  });\n\n  await handleRoute();\n}\n",
    "import {\n  addSongToPlaylist,\n  clearCache,\n  createPlaylist,\n  deletePlaylist,\n  fetchAllSongs,\n  getPlaylist,\n  listPlaylists,\n  updatePlaylist,\n  removeSongFromPlaylist\n} from '../API.js';\nimport { setCurrentSongs, setPlaybackList } from '../state.js';\nimport { playSong } from '../player.js';\nimport { renderPlaylistDetail, renderPlaylists } from '../ui.js';\nimport { switchView } from './views.js';\nimport { exportPlaylistAsM3U, exportPlaylistAsPLS } from './playlistImportExport.js';\n\nlet currentSongForPlaylist = null;\nlet lastPlaylists = [];\n\nfunction getPlaylistSortMode() {\n  try {\n    return localStorage.getItem('player0.playlists.sort') || 'pinned';\n  } catch {\n    return 'pinned';\n  }\n}\n\nfunction setPlaylistSortMode(value) {\n  try {\n    localStorage.setItem('player0.playlists.sort', value);\n  } catch {\n    // ignore\n  }\n}\n\nfunction normalizeText(value) {\n  return String(value || '').trim().toLowerCase();\n}\n\nfunction applyPlaylistFilterSort(list, { query, sortMode } = {}) {\n  const q = normalizeText(query);\n  const filtered = q\n    ? (list || []).filter(p => {\n        const name = normalizeText(p?.name);\n        const desc = normalizeText(p?.description);\n        return name.includes(q) || desc.includes(q);\n      })\n    : (list || []);\n\n  const byName = (a, b) => String(a?.name || '').localeCompare(String(b?.name || ''));\n\n  if (sortMode === 'songs') {\n    return [...filtered].sort((a, b) => {\n      const as = Number(a?.songCount || 0);\n      const bs = Number(b?.songCount || 0);\n      if (as !== bs) return bs - as;\n      return byName(a, b);\n    });\n  }\n\n  if (sortMode === 'name') {\n    return [...filtered].sort(byName);\n  }\n\n  // Default: pinned first, then name.\n  return [...filtered].sort((a, b) => {\n    const ap = Boolean(a?.pinned);\n    const bp = Boolean(b?.pinned);\n    if (ap !== bp) return ap ? -1 : 1;\n    return byName(a, b);\n  });\n}\n\nfunction wirePlaylistsControls() {\n  const search = document.getElementById('playlistSearch');\n  const sort = document.getElementById('playlistSort');\n  const grid = document.getElementById('playlistGrid');\n\n  if (sort && !sort.dataset.wired) {\n    sort.dataset.wired = '1';\n    sort.value = getPlaylistSortMode();\n    sort.addEventListener('change', () => {\n      setPlaylistSortMode(sort.value);\n      const display = applyPlaylistFilterSort(lastPlaylists, {\n        query: search?.value,\n        sortMode: sort.value\n      });\n      renderPlaylists(display);\n    });\n  }\n\n  if (search && !search.dataset.wired) {\n    search.dataset.wired = '1';\n    search.addEventListener('input', () => {\n      const display = applyPlaylistFilterSort(lastPlaylists, {\n        query: search.value,\n        sortMode: sort?.value || getPlaylistSortMode()\n      });\n      renderPlaylists(display);\n    });\n  }\n\n  if (grid && !grid.dataset.pinHandlerAttached) {\n    grid.dataset.pinHandlerAttached = '1';\n    grid.addEventListener('click', (e) => {\n      const pinBtn = e.target.closest('.playlist-pin-btn');\n      if (!pinBtn) return;\n      e.preventDefault();\n      e.stopPropagation();\n\n      const playlistId = pinBtn.dataset.playlistId;\n      const pinned = pinBtn.dataset.pinned === '1';\n      if (!playlistId) return;\n\n      void (async () => {\n        try {\n          await updatePlaylist(playlistId, { pinned: !pinned });\n          await loadPlaylists();\n        } catch (err) {\n          console.error('Toggle pin failed:', err);\n          alert('Failed to pin playlist: ' + (err?.message || err));\n        }\n      })();\n    });\n  }\n}\n\nexport async function loadPlaylists() {\n  try {\n    const playlists = await listPlaylists();\n\n    lastPlaylists = Array.isArray(playlists) ? playlists : [];\n\n    const sortMode = document.getElementById('playlistSort')?.value || getPlaylistSortMode();\n    const query = document.getElementById('playlistSearch')?.value || '';\n    renderPlaylists(applyPlaylistFilterSort(lastPlaylists, { query, sortMode }));\n\n    wirePlaylistsControls();\n\n    const createBtn = document.getElementById('createPlaylist');\n    if (createBtn) createBtn.onclick = openPlaylistModal;\n  } catch (error) {\n    console.error('Error loading playlists:', error);\n  }\n}\n\nexport function openPlaylistModal() {\n  // Backwards compatible signature:\n  // - openPlaylistModal() => create\n  // - openPlaylistModal({ mode: 'edit', playlist }) => edit\n  const arg = arguments?.[0];\n  const mode = arg?.mode === 'edit' ? 'edit' : 'create';\n  const playlist = arg?.playlist || null;\n\n  const modal = document.getElementById('playlistModal');\n  const title = modal?.querySelector('.modal-header h3');\n  const saveBtn = document.getElementById('savePlaylist');\n\n  if (mode === 'edit' && playlist?.id) {\n    modal.dataset.editingPlaylistId = String(playlist.id);\n    if (title) title.textContent = 'Edit Playlist';\n    if (saveBtn) saveBtn.textContent = 'Save Changes';\n    document.getElementById('playlistName').value = playlist.name || '';\n    document.getElementById('playlistDescription').value = playlist.description || '';\n  } else {\n    delete modal.dataset.editingPlaylistId;\n    if (title) title.textContent = 'Create New Playlist';\n    if (saveBtn) saveBtn.textContent = 'Create Playlist';\n    document.getElementById('playlistName').value = '';\n    document.getElementById('playlistDescription').value = '';\n  }\n\n  modal.style.display = 'flex';\n  document.getElementById('playlistName').focus();\n}\n\nexport function closePlaylistModal() {\n  const modal = document.getElementById('playlistModal');\n  if (!modal) return;\n  modal.style.display = 'none';\n  delete modal.dataset.editingPlaylistId;\n}\n\nexport async function savePlaylist() {\n  const name = document.getElementById('playlistName').value.trim();\n  const description = document.getElementById('playlistDescription').value.trim();\n  const modal = document.getElementById('playlistModal');\n  const editingId = modal?.dataset?.editingPlaylistId;\n\n  if (!name) {\n    alert('Please enter a playlist name');\n    return;\n  }\n\n  try {\n    if (editingId) {\n      await updatePlaylist(editingId, { name, description });\n    } else {\n      await createPlaylist(name, description, []);\n    }\n    closePlaylistModal();\n    clearCache();\n    void loadPlaylists();\n  } catch (error) {\n    console.error('Error creating playlist:', error);\n    alert('Error: ' + error.message);\n  }\n}\n\nexport async function removeFromPlaylist(playlistId, songId) {\n  try {\n    await removeSongFromPlaylist(playlistId, songId);\n    clearCache();\n    await loadPlaylistDetail(playlistId);\n  } catch (error) {\n    console.error('Error removing from playlist:', error);\n    alert('Error: ' + error.message);\n  }\n}\n\nexport function onPlaySongFromPlaylist(songs, index) {\n  setCurrentSongs(songs);\n  setPlaybackList(songs, index);\n  playSong(songs[index]);\n}\n\nexport async function loadPlaylistDetail(playlistId) {\n  try {\n    const playlist = await getPlaylist(playlistId);\n    const allSongs = await fetchAllSongs();\n\n    const playlistSongs = (playlist.songIds || [])\n      .map(id => allSongs.find(s => s.id === id))\n      .filter(Boolean);\n\n    window.currentPlaylistId = playlistId;\n    window.currentPlaylistSongs = playlistSongs;\n\n    await switchView('playlistDetailView', false);\n    window.location.hash = `#/playlist/${playlistId}`;\n    await new Promise(resolve => setTimeout(resolve, 0));\n\n    renderPlaylistDetail(playlist, playlistSongs);\n\n    const backBtn = document.getElementById('backToPlaylists');\n    if (backBtn) {\n      backBtn.onclick = () => {\n        window.location.hash = '#/playlists';\n      };\n    }\n\n    const playAllBtn = document.getElementById('playPlaylistAll');\n    if (playAllBtn) {\n      playAllBtn.onclick = () => {\n        if (playlistSongs.length > 0) {\n          setCurrentSongs(playlistSongs);\n          setPlaybackList(playlistSongs, 0);\n          playSong(playlistSongs[0]);\n        }\n      };\n    }\n\n    const shuffleBtn = document.getElementById('playlistShuffle');\n    if (shuffleBtn) {\n      shuffleBtn.onclick = () => {\n        if (!playlistSongs.length) return;\n        const shuffled = [...playlistSongs]\n          .map((s) => ({ s, r: Math.random() }))\n          .sort((a, b) => a.r - b.r)\n          .map((x) => x.s);\n        setCurrentSongs(shuffled);\n        setPlaybackList(shuffled, 0);\n        playSong(shuffled[0]);\n      };\n    }\n\n    const editBtn = document.getElementById('playlistEdit');\n    if (editBtn) {\n      editBtn.onclick = () => {\n        openPlaylistModal({ mode: 'edit', playlist });\n      };\n    }\n\n    const delBtn = document.getElementById('playlistDelete');\n    if (delBtn) {\n      delBtn.onclick = () => {\n        const ok = confirm(`Delete playlist \"${playlist.name || 'Untitled Playlist'}\"?`);\n        if (!ok) return;\n        void (async () => {\n          try {\n            await deletePlaylist(playlistId);\n            clearCache();\n            window.location.hash = '#/playlists';\n            await loadPlaylists();\n          } catch (err) {\n            console.error('Delete playlist failed:', err);\n            alert('Delete failed: ' + (err?.message || err));\n          }\n        })();\n      };\n    }\n\n    const exportM3uBtn = document.getElementById('playlistExportM3U');\n    if (exportM3uBtn) {\n      exportM3uBtn.onclick = () => {\n        exportPlaylistAsM3U(playlist.name, playlistSongs);\n      };\n    }\n\n    const exportPlsBtn = document.getElementById('playlistExportPLS');\n    if (exportPlsBtn) {\n      exportPlsBtn.onclick = () => {\n        exportPlaylistAsPLS(playlist.name, playlistSongs);\n      };\n    }\n\n  } catch (error) {\n    console.error('Error loading playlist:', error);\n    alert('Error loading playlist: ' + error.message);\n  }\n}\n\nexport async function openAddToPlaylistModal(songId) {\n  currentSongForPlaylist = songId;\n  const modal = document.getElementById('addToPlaylistModal');\n  const listContainer = document.getElementById('playlistSelectionList');\n\n  try {\n    const playlists = await listPlaylists();\n    listContainer.innerHTML = '';\n\n    if (playlists.length === 0) {\n      listContainer.innerHTML = '<p style=\"text-align: center; color: var(--text-secondary); padding: 24px;\">No playlists yet. Create one below!</p>';\n    } else {\n      playlists.forEach(playlist => {\n        const item = document.createElement('div');\n        item.className = 'playlist-selection-item';\n        item.innerHTML = `\n          <div>\n            <div style=\"font-weight: 500;\">${escapeHtml(playlist.name)}</div>\n            <div style=\"font-size: 12px; color: var(--text-secondary);\">${playlist.songCount || 0} songs</div>\n          </div>\n        `;\n        item.onclick = async () => {\n          try {\n            await addSongToPlaylist(playlist.id, songId);\n            modal.style.display = 'none';\n\n            clearCache();\n\n            if (window.currentPlaylistId === playlist.id) {\n              await loadPlaylistDetail(playlist.id);\n            }\n\n            alert(`Added to ${playlist.name}`);\n          } catch (error) {\n            console.error('Error adding to playlist:', error);\n            alert('Error: ' + error.message);\n          }\n        };\n        listContainer.appendChild(item);\n      });\n    }\n\n    modal.style.display = 'flex';\n  } catch (error) {\n    console.error('Error loading playlists:', error);\n    alert('Error loading playlists');\n  }\n}\n\nfunction escapeHtml(text) {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\n// Globals used by UI renderers\nwindow.onPlaySongFromPlaylist = onPlaySongFromPlaylist;\nwindow.loadPlaylistDetail = loadPlaylistDetail;\nwindow.openAddToPlaylistModal = openAddToPlaylistModal;\n",
    "import { closePlaylistModal, openPlaylistModal, savePlaylist } from './playlists.js';\n\nexport function setupModal() {\n  // Create playlist modal\n  const closePlaylist = document.getElementById('closePlaylistModal');\n  const cancelPlaylist = document.getElementById('cancelPlaylist');\n  const savePlaylistBtn = document.getElementById('savePlaylist');\n\n  if (closePlaylist) closePlaylist.onclick = () => closePlaylistModal();\n  if (cancelPlaylist) cancelPlaylist.onclick = () => closePlaylistModal();\n  if (savePlaylistBtn) savePlaylistBtn.onclick = () => { void savePlaylist(); };\n\n  const playlistModal = document.getElementById('playlistModal');\n  if (playlistModal) {\n    playlistModal.onclick = (e) => {\n      if (e.target?.id === 'playlistModal') closePlaylistModal();\n    };\n  }\n\n  // Add to Playlist modal\n  const closeAdd = document.getElementById('closeAddToPlaylistModal');\n  const addToPlaylistModal = document.getElementById('addToPlaylistModal');\n  if (closeAdd && addToPlaylistModal) {\n    closeAdd.onclick = () => {\n      addToPlaylistModal.style.display = 'none';\n    };\n  }\n\n  const createFromAdd = document.getElementById('createNewPlaylistFromAdd');\n  if (createFromAdd && addToPlaylistModal) {\n    createFromAdd.onclick = () => {\n      addToPlaylistModal.style.display = 'none';\n      openPlaylistModal();\n    };\n  }\n\n  // Keyboard shortcuts modal\n  const shortcutsBtn = document.getElementById('keyboardShortcutsBtn');\n  const shortcutsModal = document.getElementById('keyboardShortcutsModal');\n  const closeShortcutsBtn = document.getElementById('closeShortcutsModal');\n\n  if (shortcutsBtn && shortcutsModal) {\n    shortcutsBtn.onclick = () => {\n      shortcutsModal.style.display = 'flex';\n    };\n  }\n  if (closeShortcutsBtn && shortcutsModal) {\n    closeShortcutsBtn.onclick = () => {\n      shortcutsModal.style.display = 'none';\n    };\n  }\n  if (shortcutsModal) {\n    shortcutsModal.onclick = (e) => {\n      if (e.target?.id === 'keyboardShortcutsModal') shortcutsModal.style.display = 'none';\n    };\n  }\n\n  // Stats list modal\n  const statsListModal = document.getElementById('statsListModal');\n  const closeStatsListModalBtn = document.getElementById('closeStatsListModal');\n\n  if (closeStatsListModalBtn && statsListModal) {\n    closeStatsListModalBtn.onclick = () => {\n      statsListModal.style.display = 'none';\n    };\n    statsListModal.onclick = (e) => {\n      if (e.target?.id === 'statsListModal') statsListModal.style.display = 'none';\n    };\n  }\n}\n\nexport function closeAllModals() {\n  const ids = ['playlistModal', 'addToPlaylistModal', 'keyboardShortcutsModal', 'statsListModal'];\n  ids.forEach((id) => {\n    const el = document.getElementById(id);\n    if (el) el.style.display = 'none';\n  });\n}\n",
    "import { scanLibrary as scanLibraryAPI, clearCache } from '../API.js';\n\nexport async function scanLibrary() {\n  const button = document.getElementById('scanButton');\n  if (!button) return;\n\n  button.disabled = true;\n  button.innerHTML = '<svg class=\"icon\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.2\"/></svg><span>Scanning...</span>';\n\n  try {\n    const result = await scanLibraryAPI();\n    clearCache();\n    alert(`Scan complete!\\nAdded: ${result.added}\\nUpdated: ${result.updated}\\nTotal: ${result.total}`);\n    window.location.reload();\n  } catch (error) {\n    console.error('Scan error:', error);\n    alert('Error scanning library');\n    button.disabled = false;\n    button.innerHTML = '<svg class=\"icon\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><circle cx=\"12\" cy=\"12\" r=\"10\"/><circle cx=\"12\" cy=\"12\" r=\"3\"/><path d=\"M12 2v4M12 18v4M2 12h4M18 12h4\"/></svg><span>Scan Library</span>';\n  }\n}\n",
    "import { switchView } from './views.js';\nimport { scanLibrary } from './scan.js';\nimport { removeFromPlaylist } from './playlists.js';\nimport { allSongs, currentSongs, enqueueSongs, playNextSongs } from '../state.js';\nimport { updateQueue } from '../player.js';\n\nasync function copyToClipboard(text) {\n  const value = String(text || '').trim();\n  if (!value) return;\n\n  try {\n    await navigator.clipboard.writeText(value);\n    return;\n  } catch {\n    // Fallback for older/locked-down contexts.\n  }\n\n  const ta = document.createElement('textarea');\n  ta.value = value;\n  ta.setAttribute('readonly', '');\n  ta.style.position = 'fixed';\n  ta.style.top = '-9999px';\n  ta.style.left = '-9999px';\n  document.body.appendChild(ta);\n  ta.select();\n  try {\n    document.execCommand('copy');\n  } finally {\n    ta.remove();\n  }\n}\n\nfunction resolveSongFromActionButton(btn) {\n  const songId = btn?.dataset?.songId;\n  const songContext = btn?.dataset?.songContext;\n  const index = Number(btn?.dataset?.songIndex);\n\n  const tryFindInList = (list) => {\n    if (!Array.isArray(list) || list.length === 0) return null;\n    if (Number.isFinite(index) && index >= 0 && index < list.length) {\n      const byIndex = list[index];\n      if (byIndex && (!songId || byIndex.id === songId)) return byIndex;\n    }\n    if (songId) return list.find((s) => s?.id === songId) || null;\n    return null;\n  };\n\n  if (songContext === 'playlist') {\n    const fromPlaylist = tryFindInList(window.currentPlaylistSongs);\n    if (fromPlaylist) return fromPlaylist;\n  }\n\n  const fromCurrent = tryFindInList(currentSongs);\n  if (fromCurrent) return fromCurrent;\n\n  const fromAll = tryFindInList(allSongs);\n  if (fromAll) return fromAll;\n\n  const fromPlaylistFallback = tryFindInList(window.currentPlaylistSongs);\n  if (fromPlaylistFallback) return fromPlaylistFallback;\n\n  return null;\n}\n\nexport function setupNavigation() {\n  document.querySelectorAll('.nav-item').forEach(item => {\n    item.addEventListener('click', (e) => {\n      e.preventDefault();\n\n      const action = item.dataset.action;\n      if (action === 'search') {\n        const isMobile = window.matchMedia('(max-width: 700px)').matches;\n        if (!isMobile) return;\n\n        const isOpen = document.body.classList.toggle('mobile-search-open');\n\n        if (!isOpen) {\n          document.getElementById('searchInput')?.blur();\n\n          const advanced = document.getElementById('advancedSearch');\n          if (advanced) advanced.style.display = 'none';\n          document.getElementById('advancedSearchToggle')?.classList.remove('active');\n          return;\n        }\n\n        const header = document.querySelector('.header');\n        header?.scrollIntoView({ behavior: 'smooth', block: 'start' });\n\n        // Focus search input so the keyboard opens on mobile.\n        const input = document.getElementById('searchInput');\n        if (input) {\n          input.focus();\n          input.select?.();\n        }\n        return;\n      }\n\n      const view = item.dataset.view;\n      if (!view) return;\n      void switchView(view);\n    });\n  });\n\n  document.getElementById('scanButton')?.addEventListener('click', () => {\n    void scanLibrary();\n  });\n\n  // Add to playlist button delegation\n  document.addEventListener('click', (e) => {\n    if (e.target.closest('.add-to-playlist-btn')) {\n      const btn = e.target.closest('.add-to-playlist-btn');\n      const songId = btn.dataset.songId;\n      if (songId) {\n        window.openAddToPlaylistModal?.(songId);\n      }\n    }\n\n    // Remove from playlist button\n    if (e.target.closest('.remove-from-playlist-btn')) {\n      const btn = e.target.closest('.remove-from-playlist-btn');\n      const songId = btn.dataset.songId;\n      if (songId && window.currentPlaylistId) {\n        void removeFromPlaylist(window.currentPlaylistId, songId);\n      }\n    }\n\n    if (e.target.closest('.song-copy-btn')) {\n      const btn = e.target.closest('.song-copy-btn');\n      const text = btn.dataset.copyText;\n      void copyToClipboard(text);\n    }\n\n    if (e.target.closest('.song-row-queue-btn')) {\n      const btn = e.target.closest('.song-row-queue-btn');\n      const song = resolveSongFromActionButton(btn);\n      if (!song) return;\n      enqueueSongs(song);\n      updateQueue();\n    }\n\n    if (e.target.closest('.song-row-play-next-btn')) {\n      const btn = e.target.closest('.song-row-play-next-btn');\n      const song = resolveSongFromActionButton(btn);\n      if (!song) return;\n      playNextSongs(song);\n      updateQueue();\n    }\n  });\n}\n",
    "import { initPlayer, playNext, playPrevious, seek, setVolume, togglePlayPause } from '../player.js';\nimport { closeAllModals } from './uiModals.js';\n\nexport function setupPlayerControls() {\n  const audioPlayer = document.getElementById('audioPlayer');\n  if (!audioPlayer) return;\n\n  const playPauseButton = document.getElementById('playPauseButton');\n  const prevButton = document.getElementById('prevButton');\n  const nextButton = document.getElementById('nextButton');\n  const progressBar = document.getElementById('progressBar');\n  const volumeSlider = document.getElementById('volumeSlider');\n\n  initPlayer(audioPlayer);\n\n  playPauseButton?.addEventListener('click', togglePlayPause);\n  prevButton?.addEventListener('click', playPrevious);\n  nextButton?.addEventListener('click', playNext);\n\n  progressBar?.addEventListener('input', (e) => {\n    seek(e.target.value);\n  });\n\n  volumeSlider?.addEventListener('input', (e) => {\n    setVolume(e.target.value / 100);\n  });\n\n  // Keyboard shortcuts\n  document.addEventListener('keydown', (e) => {\n    const tag = e.target?.tagName;\n    if (tag === 'INPUT' || tag === 'TEXTAREA') {\n      if ((e.ctrlKey || e.metaKey) && (e.key === 'f' || e.key === 'k')) {\n        // allow below\n      } else {\n        return;\n      }\n    }\n\n    switch (e.key) {\n      case ' ':\n        e.preventDefault();\n        togglePlayPause();\n        break;\n      case 'ArrowRight':\n        e.preventDefault();\n        playNext();\n        break;\n      case 'ArrowLeft':\n        e.preventDefault();\n        playPrevious();\n        break;\n      case 's':\n      case 'S':\n        e.preventDefault();\n        document.getElementById('shuffleButton')?.click();\n        break;\n      case 'r':\n      case 'R':\n        e.preventDefault();\n        document.getElementById('repeatButton')?.click();\n        break;\n      case 'ArrowUp': {\n        e.preventDefault();\n        const currentVol = audioPlayer.volume;\n        setVolume(Math.min(1, currentVol + 0.1));\n        if (volumeSlider) volumeSlider.value = String(Math.min(100, Number(volumeSlider.value || 0) + 10));\n        break;\n      }\n      case 'ArrowDown': {\n        e.preventDefault();\n        const currentVol = audioPlayer.volume;\n        setVolume(Math.max(0, currentVol - 0.1));\n        if (volumeSlider) volumeSlider.value = String(Math.max(0, Number(volumeSlider.value || 0) - 10));\n        break;\n      }\n      case 'k':\n        if (e.ctrlKey || e.metaKey) {\n          e.preventDefault();\n          document.getElementById('searchInput')?.focus();\n        }\n        break;\n      case 'p':\n        if (e.ctrlKey || e.metaKey) {\n          e.preventDefault();\n          const m = document.getElementById('keyboardShortcutsModal');\n          if (m) m.style.display = 'flex';\n        }\n        break;\n      case 'Escape':\n        closeAllModals();\n        break;\n    }\n  });\n\n  // Mini player controls\n  document.getElementById('miniPlayPause')?.addEventListener('click', togglePlayPause);\n  document.getElementById('miniPrev')?.addEventListener('click', playPrevious);\n  document.getElementById('miniNext')?.addEventListener('click', playNext);\n}\n",
    "function clearPendingHideTimeout() {\n  const id = window.__player0PendingHideSidebarTimeout;\n  if (id) {\n    clearTimeout(id);\n    window.__player0PendingHideSidebarTimeout = null;\n  }\n}\n\nfunction setPendingHideTimeout(id) {\n  window.__player0PendingHideSidebarTimeout = id;\n}\n\nexport function setupSidebar() {\n  const nowPlayingSidebar = document.getElementById('nowPlayingSidebar');\n  const miniPlayer = document.getElementById('miniPlayer');\n  const appContainer = document.querySelector('.app-container');\n  const closeSidebar = document.getElementById('closeSidebar');\n  const expandSidebar = document.getElementById('expandSidebar');\n  const miniQueue = document.getElementById('miniQueue');\n\n  if (!nowPlayingSidebar || !miniPlayer || !appContainer) return;\n\n  function isMobile() {\n    return window.matchMedia('(max-width: 700px)').matches;\n  }\n\n  function openSidebar({ scrollToQueue = false } = {}) {\n    clearPendingHideTimeout();\n\n    nowPlayingSidebar.style.display = 'flex';\n    requestAnimationFrame(() => {\n      nowPlayingSidebar.style.transform = isMobile() ? 'translateY(0)' : 'translateX(0)';\n    });\n\n    miniPlayer.style.transform = 'translateY(100%)';\n    setPendingHideTimeout(setTimeout(() => {\n      miniPlayer.style.display = 'none';\n      setPendingHideTimeout(null);\n    }, 400));\n\n    appContainer.classList.remove('sidebar-closed');\n\n    if (scrollToQueue) {\n      // Wait for display/transform updates to settle.\n      setTimeout(() => {\n        const queueEl = nowPlayingSidebar.querySelector('.np-queue');\n        queueEl?.scrollIntoView({ block: 'start', behavior: 'smooth' });\n      }, 0);\n    }\n  }\n\n  closeSidebar?.addEventListener('click', () => {\n    nowPlayingSidebar.style.transform = isMobile() ? 'translateY(100%)' : 'translateX(320px)';\n\n    if (document.body.classList.contains('has-mini-player')) {\n      miniPlayer.style.display = 'flex';\n      requestAnimationFrame(() => {\n        miniPlayer.style.transform = 'translateY(0)';\n      });\n    } else {\n      miniPlayer.style.display = 'none';\n      miniPlayer.style.transform = 'translateY(100%)';\n    }\n\n    clearPendingHideTimeout();\n    setPendingHideTimeout(setTimeout(() => {\n      nowPlayingSidebar.style.display = 'none';\n      setPendingHideTimeout(null);\n    }, 400));\n\n    appContainer.classList.add('sidebar-closed');\n  });\n\n  expandSidebar?.addEventListener('click', () => {\n    openSidebar({ scrollToQueue: false });\n  });\n\n  miniQueue?.addEventListener('click', () => {\n    // If sidebar is already open, just scroll to queue.\n    if (nowPlayingSidebar.style.display !== 'none' && !appContainer.classList.contains('sidebar-closed')) {\n      const queueEl = nowPlayingSidebar.querySelector('.np-queue');\n      queueEl?.scrollIntoView({ block: 'start', behavior: 'smooth' });\n      return;\n    }\n\n    openSidebar({ scrollToQueue: true });\n  });\n}\n",
    "let wired = false;\n\nfunction resetMenu(menu) {\n  if (!menu) return;\n  menu.classList.remove('is-fixed');\n  menu.style.left = '';\n  menu.style.top = '';\n  menu.style.minWidth = '';\n  menu.style.maxHeight = '';\n  menu.style.overflowY = '';\n}\n\nfunction positionMenu(dropdown) {\n  const trigger = dropdown?.querySelector?.('[data-dropdown-trigger]');\n  const menu = dropdown?.querySelector?.('.dropdown-menu');\n  if (!trigger || !menu) return;\n\n  // Ensure menu is not clipped by overflow containers.\n  menu.classList.add('is-fixed');\n\n  const triggerRect = trigger.getBoundingClientRect();\n\n  // Make menu at least as wide as the trigger.\n  const triggerWidth = Math.ceil(triggerRect.width);\n  menu.style.minWidth = `${Math.max(180, triggerWidth)}px`;\n\n  // Measure after minWidth applies.\n  const menuWidth = Math.ceil(menu.offsetWidth);\n  const menuHeight = Math.ceil(menu.offsetHeight);\n\n  const margin = 8;\n  let left = triggerRect.right - menuWidth;\n  left = Math.max(margin, Math.min(left, window.innerWidth - margin - menuWidth));\n\n  let top = triggerRect.bottom + margin;\n  const wouldOverflowBottom = top + menuHeight > window.innerHeight - margin;\n  if (wouldOverflowBottom) {\n    top = triggerRect.top - margin - menuHeight;\n  }\n\n  // Clamp into viewport and enable internal scrolling if needed.\n  const maxTop = window.innerHeight - margin - menuHeight;\n  top = Math.max(margin, Math.min(top, Math.max(margin, maxTop)));\n\n  const availableBelow = window.innerHeight - margin - top;\n  menu.style.maxHeight = `${Math.max(160, availableBelow)}px`;\n  menu.style.overflowY = 'auto';\n\n  menu.style.left = `${Math.round(left)}px`;\n  menu.style.top = `${Math.round(top)}px`;\n}\n\nfunction positionOpenMenus() {\n  document.querySelectorAll('.dropdown.is-open').forEach((dropdown) => {\n    positionMenu(dropdown);\n  });\n}\n\nfunction closeAll(exceptDropdown = null) {\n  document.querySelectorAll('.dropdown.is-open').forEach((d) => {\n    if (exceptDropdown && d === exceptDropdown) return;\n    d.classList.remove('is-open');\n    const trigger = d.querySelector('[data-dropdown-trigger]');\n    if (trigger) trigger.setAttribute('aria-expanded', 'false');\n\n    resetMenu(d.querySelector('.dropdown-menu'));\n  });\n}\n\nfunction toggleDropdown(trigger) {\n  const dropdown = trigger.closest('.dropdown');\n  if (!dropdown) return;\n\n  const willOpen = !dropdown.classList.contains('is-open');\n  closeAll(dropdown);\n\n  dropdown.classList.toggle('is-open', willOpen);\n  trigger.setAttribute('aria-expanded', willOpen ? 'true' : 'false');\n\n  if (willOpen) {\n    // Defer positioning/focus until after styles apply.\n    queueMicrotask(() => {\n      positionMenu(dropdown);\n      const firstItem = dropdown.querySelector('.dropdown-menu .dropdown-item');\n      if (firstItem) firstItem.focus();\n    });\n  } else {\n    resetMenu(dropdown.querySelector('.dropdown-menu'));\n  }\n}\n\nexport function setupDropdowns() {\n  if (wired) return;\n  wired = true;\n\n  document.addEventListener('click', (e) => {\n    const trigger = e.target?.closest?.('[data-dropdown-trigger]');\n    if (trigger) {\n      e.preventDefault();\n      toggleDropdown(trigger);\n      return;\n    }\n\n    const item = e.target?.closest?.('.dropdown-item');\n    if (item) {\n      const dropdown = item.closest('.dropdown');\n      if (dropdown) {\n        dropdown.classList.remove('is-open');\n        const t = dropdown.querySelector('[data-dropdown-trigger]');\n        if (t) t.setAttribute('aria-expanded', 'false');\n\n        resetMenu(dropdown.querySelector('.dropdown-menu'));\n      }\n      return;\n    }\n\n    // Click outside closes everything.\n    if (!e.target?.closest?.('.dropdown')) closeAll();\n  });\n\n  document.addEventListener('keydown', (e) => {\n    if (e.key === 'Escape') {\n      closeAll();\n      return;\n    }\n\n    // Simple keyboard navigation inside open menus.\n    const open = document.querySelector('.dropdown.is-open');\n    if (!open) return;\n\n    const items = Array.from(open.querySelectorAll('.dropdown-menu .dropdown-item'));\n    if (items.length === 0) return;\n\n    const active = document.activeElement;\n    const idx = items.indexOf(active);\n\n    if (e.key === 'ArrowDown') {\n      e.preventDefault();\n      const next = items[(idx + 1 + items.length) % items.length];\n      next.focus();\n      return;\n    }\n\n    if (e.key === 'ArrowUp') {\n      e.preventDefault();\n      const prev = items[(idx - 1 + items.length) % items.length];\n      prev.focus();\n      return;\n    }\n\n    if (e.key === 'Enter' && idx >= 0) {\n      e.preventDefault();\n      items[idx].click();\n    }\n  });\n\n  window.addEventListener('blur', () => closeAll());\n  window.addEventListener('resize', () => positionOpenMenus());\n  window.addEventListener('scroll', () => positionOpenMenus(), true);\n}\n",
    "import { setupModal } from './uiModals.js';\nimport { setupNavigation } from './navigation.js';\nimport { setupSearch } from './search.js';\nimport { setupPlayerControls } from './playerSetup.js';\nimport { setupSidebar } from './sidebar.js';\nimport { initRouter } from './views.js';\nimport { setupDropdowns } from './dropdowns.js';\nimport { initLazyLoading } from '../utils.js';\n\nexport function bootstrapApp() {\n  document.addEventListener('DOMContentLoaded', async () => {\n    // Initialize lazy loading for images\n    initLazyLoading();\n    \n    setupNavigation();\n    setupSearch();\n    setupPlayerControls();\n    setupSidebar();\n    setupModal();\n    setupDropdowns();\n\n    // IMPORTANT: initRouter() triggers the initial view load.\n    await initRouter();\n\n    // Default: keep the now playing sidebar closed.\n    // Users can expand it (mini player arrow or queue button).\n    const nowPlayingSidebar = document.getElementById('nowPlayingSidebar');\n    const miniPlayer = document.getElementById('miniPlayer');\n\n    const mobileQuery = window.matchMedia('(max-width: 700px)');\n    const isMobile = mobileQuery.matches;\n\n    if (nowPlayingSidebar) {\n      // Desktop: slide in from right. Mobile: fullscreen sheet from bottom.\n      nowPlayingSidebar.style.display = 'none';\n      nowPlayingSidebar.style.transform = isMobile ? 'translateY(100%)' : 'translateX(320px)';\n    }\n    if (miniPlayer) {\n      // Hidden by default; will be shown when something is loaded/playing.\n      miniPlayer.style.display = 'none';\n      miniPlayer.style.transform = 'translateY(100%)';\n    }\n    document.querySelector('.app-container')?.classList.add('sidebar-closed');\n  });\n}\n",
    "import { bootstrapApp } from './js/app/shell.js';\n\n// Register Service Worker for offline support\nif ('serviceWorker' in navigator) {\n  window.addEventListener('load', async () => {\n    try {\n      const registration = await navigator.serviceWorker.register('/sw.js', {\n        scope: '/'\n      });\n      \n      console.log('Service Worker registered:', registration.scope);\n      \n      // Handle updates\n      registration.addEventListener('updatefound', () => {\n        const newWorker = registration.installing;\n        console.log('Service Worker update found');\n        \n        newWorker?.addEventListener('statechange', () => {\n          if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {\n            // New version available\n            console.log('New version available! Refresh to update.');\n            \n            // Optionally show update notification\n            if (window.showUpdateNotification) {\n              window.showUpdateNotification();\n            }\n          }\n        });\n      });\n    } catch (error) {\n      console.error('Service Worker registration failed:', error);\n    }\n  });\n}\n\nbootstrapApp();\n\n"
  ],
  "mappings": "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",
  "debugId": "68F077E9AE853D3A64756E2164756E21",
  "names": []
}